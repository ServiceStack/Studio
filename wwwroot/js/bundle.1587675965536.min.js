(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var AuthModal=(function(_super){__extends(AuthModal,_super);function AuthModal(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(AuthModal.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(AuthModal.prototype,"enabled",{get:function(){return this.app&&this.app.plugins.auth;},enumerable:true,configurable:true});Object.defineProperty(AuthModal.prototype,"providerUrl",{get:function(){return this.provider?this.app.app.baseUrl+"/auth/"+this.provider:this.app.app.baseUrl+'/auth?noredirect';},enumerable:true,configurable:true});Object.defineProperty(AuthModal.prototype,"displayUrl",{get:function(){return shared_1.splitOnFirst(this.providerUrl,'?')[0];},enumerable:true,configurable:true});Object.defineProperty(AuthModal.prototype,"url",{get:function(){var baseUrl=this.app.app.baseUrl;var suffix=this.provider?'/'+this.provider+("?continue="+encodeURIComponent('/auth')+"&"):'?';return baseUrl+"/auth"+suffix+"noredirect";},enumerable:true,configurable:true});AuthModal.prototype.mounted=function(){var _this=this;var iframe=document.querySelector('#auth-frame');window.addEventListener('message',function(e){var _a,_b;if(e.source==((_a=iframe)===null||_a===void 0?void 0:_a.contentWindow)&&((_b=e.data)===null||_b===void 0?void 0:_b.copy)){_this.$emit('done',e.data.copy);}});};__decorate([vue_property_decorator_1.Prop({default:null})],AuthModal.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],AuthModal.prototype,"provider",void 0);AuthModal=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\" id=\"authModal\" class=\"modal\" tabindex=\"-1\" role=\"dialog\" style=\"display:block\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <div v-if=\"url\">\n                <h5 class=\"modal-title\">\n                    Session for <a :href=\"providerUrl\" target=\"_blank\">{{displayUrl}}</a>\n                </h5>\n            </div>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" @click=\"$emit('done')\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <iframe id=\"auth-frame\" v-if=\"url\" :src=\"url\" />\n          </div>\n        </div>\n      </div>\n    </div>",})],AuthModal);return AuthModal;}(vue_property_decorator_1.Vue));exports.AuthModal=AuthModal;exports.default=AuthModal;vue_property_decorator_1.Vue.component('auth-modal',AuthModal);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var AuthSecret=(function(_super){__extends(AuthSecret,_super);function AuthSecret(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;_this.token='';return _this;}
Object.defineProperty(AuthSecret.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(AuthSecret.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'auth');},enumerable:true,configurable:true});AuthSecret.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,provider:'authsecret',accessToken:this.token,}))];case 1:response=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:response});this.$emit('done');return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],AuthSecret.prototype,"slug",void 0);AuthSecret=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\">\n        <form ref=\"form\" @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary except=\"token\" :responseStatus=\"responseStatus\" />\n            </div>\n            <div class=\"form-group\">\n                <v-input id=\"token\" v-model=\"token\" placeholder=\"AuthSecret\" :responseStatus=\"responseStatus\" \n                         help=\"The configured AdminAuthSecret\" />\n                <a href=\"https://docs.servicestack.net/debugging#authsecret\" class=\"lnk-help help-muted\" target=\"_blank\" title=\"help\"></a>                                \n            </div>\n            <div class=\"form-group\">\n                <button type=\"submit\" class=\"btn btn-lg btn-outline-primary\">Login</button>\n            </div>\n        </form>\n    </div>",})],AuthSecret);return AuthSecret;}(vue_property_decorator_1.Vue));exports.AuthSecret=AuthSecret;exports.default=AuthSecret;vue_property_decorator_1.Vue.component('auth-secret',AuthSecret);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var BearerToken=(function(_super){__extends(BearerToken,_super);function BearerToken(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;_this.token='';return _this;}
Object.defineProperty(BearerToken.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(BearerToken.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'auth');},enumerable:true,configurable:true});BearerToken.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,provider:'bearer',accessToken:this.token,}))];case 1:response=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:response});this.$emit('done');return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],BearerToken.prototype,"slug",void 0);BearerToken=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\">\n        <form ref=\"form\" @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary except=\"token\" :responseStatus=\"responseStatus\" />\n            </div>\n            <div class=\"form-group\">\n                <v-input id=\"token\" v-model=\"token\" placeholder=\"Bearer Token\" :responseStatus=\"responseStatus\" \n                         help=\"Any BearerToken Auth Providers, e.g. JWT or API Key\" />\n            </div>\n            <div class=\"form-group\">\n                <button type=\"submit\" class=\"btn btn-lg btn-outline-primary\">Login</button>\n            </div>\n        </form>\n    </div>",})],BearerToken);return BearerToken;}(vue_property_decorator_1.Vue));exports.BearerToken=BearerToken;exports.default=BearerToken;vue_property_decorator_1.Vue.component('bearer-token',BearerToken);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var Credentials=(function(_super){__extends(Credentials,_super);function Credentials(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;_this.userName='';_this.password='';return _this;}
Object.defineProperty(Credentials.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Credentials.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'auth');},enumerable:true,configurable:true});Credentials.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,provider:'credentials',userName:this.userName,password:this.password,rememberMe:true,}))];case 1:response=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:response});this.$emit('done');return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],Credentials.prototype,"slug",void 0);Credentials=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\">\n        <form ref=\"form\" @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary except=\"userName,password\" :responseStatus=\"responseStatus\" />\n            </div>\n            <div class=\"form-group\">\n                <v-input id=\"userName\" v-model=\"userName\" placeholder=\"Username\" :responseStatus=\"responseStatus\" \n                        help=\"Username or Email you signed up with\" />\n            </div>\n            <div class=\"form-group\">\n                <v-input type=\"password\" id=\"password\" v-model=\"password\" placeholder=\"Password\" :responseStatus=\"responseStatus\" />\n            </div>\n            <div class=\"form-group\">\n                <button type=\"submit\" class=\"btn btn-lg btn-outline-primary\">Login</button>\n            </div>\n        </form>\n    </div>",})],Credentials);return Credentials;}(vue_property_decorator_1.Vue));exports.Credentials=Credentials;exports.default=Credentials;vue_property_decorator_1.Vue.component('credentials',Credentials);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var router_1=require("../../shared/router");var Auth=(function(_super){__extends(Auth,_super);function Auth(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;_this.showAuthDialog=false;_this.showUserPopup=false;_this.tab='';_this.userName='';_this.password='';_this.rememberMe=true;return _this;}
Object.defineProperty(Auth.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"site",{get:function(){return shared_1.store.getSite(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"appInfo",{get:function(){return shared_1.store.getApp(this.slug).app;},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'auth');},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"plugin",{get:function(){var _a;return(_a=this.app)===null||_a===void 0?void 0:_a.plugins.auth;},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"session",{get:function(){return shared_1.store.getSession(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"prefsDirty",{get:function(){return shared_1.store.isDirty(this.slug);},enumerable:true,configurable:true});Auth.prototype.goto=function(feature){switch(feature){case'autoquery':this.$router.push(router_1.autoQueryRoute(this.slug,this.op?{op:this.op}:null));break;case'validation':this.$router.push(router_1.validationRoute(this.slug,this.op?{op:this.op}:null));break;}};Auth.prototype.activeTab=function(tab){var _a;return this.tab?this.tab==tab:this.plugin&&((_a=this.plugin.authProviders[0])===null||_a===void 0?void 0:_a.name)==tab;};Auth.prototype.hasProvider=function(provider){return this.plugin.authProviders.some(function(x){return x.name==provider;});};Object.defineProperty(Auth.prototype,"hasBearer",{get:function(){return this.plugin.authProviders.some(function(x){return x.type=='Bearer';});},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"hasOAuth",{get:function(){return this.plugin.authProviders.some(function(x){return x.type=='oauth';});},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"oauthProviders",{get:function(){return this.plugin.authProviders.filter(function(x){return x.type=='oauth';});},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"hasSession",{get:function(){return this.plugin.authProviders.some(function(x){return x.type=='credentials'||x.type=='oauth';});},enumerable:true,configurable:true});Object.defineProperty(Auth.prototype,"hasAuthSecret",{get:function(){return this.plugin.hasAuthSecret;},enumerable:true,configurable:true});Auth.prototype.modalKeyDown=function(e){if(this.showAuthDialog&&e.key=="Escape"){this.showAuthDialog=false;return;}
if(e.ctrlKey&&e.key==="s"){this.savePrefs();e.preventDefault();return;}};Auth.prototype.beforeDestroy=function(){window.removeEventListener('keydown',this.modalKeyDown);};Auth.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:window.addEventListener('keydown',this.modalKeyDown);shared_1.bus.$on('signin',function(){shared_1.log('signin',_this.session);if(!_this.session){_this.showAuthDialog=true;}});return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response,e_1;return __generator(this,function(_a){switch(_a.label){case 0:if(!(this.app&&!this.session))return[3,4];_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,}))];case 2:response=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:response});return[3,4];case 3:e_1=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:null});throw e_1;case 4:return[2];}});});})];case 1:_a.sent();return[2];}});});};Auth.prototype.savePrefs=function(){var _this=this;this.loading=true;setTimeout(function(){return _this.loading=false;},300);shared_1.bus.$emit('savePrefs',{slug:this.slug});};Auth.prototype.logout=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,provider:'logout',}))];case 1:response=_a.sent();shared_1.bus.$emit('savePrefs',{slug:this.slug,callback:function(){shared_1.bus.$emit('signout',{slug:_this.slug});_this.showUserPopup=false;}});return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],Auth.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],Auth.prototype,"feature",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],Auth.prototype,"op",void 0);Auth=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\">\n        <button v-if=\"!session && !loading\" @click=\"showAuthDialog=true\" class=\"btn btn-outline-primary\">\n            Sign In\n        </button>\n        <span v-if=\"session\">\n        \n            <div class=\"btn-group\" role=\"group\">\n                <button v-if=\"feature != 'autoquery'\" class=\"btn btn-light btn-sm\" @click=\"goto('autoquery')\"\n                        title=\"Go to AutoQuery\"><i class=\"svg-db svg-lg\"/></button>\n                <button v-if=\"feature != 'validation'\" class=\"btn btn-light btn-sm\" @click=\"goto('validation')\"\n                        title=\"Go to Validation\"><i class=\"svg-lock svg-lg\"/></button>\n                <button v-if=\"prefsDirty || loading\" @click=\"savePrefs()\" title=\"Save Preferences\" \n                        class=\"btn btn-light btn-sm\"><i :class=\"(loading ? 'svg-loading' : 'svg-save_alt') + ' svg-lg'\" /></button>            \n                <div class=\"btn-group\" role=\"group\">\n                    <button @click=\"showUserPopup=!showUserPopup\" id=\"btnGroupDrop1\" type=\"button\" class=\"btn btn-light dropdown-toggle\">\n                        <img v-if=\"session.profileUrl\" :src=\"session.profileUrl\" class=\"sq-lg mr-1 mb-1\">\n                        <i v-else class=\"svg-auth svg-2x mb-1\" />\n                        {{session.displayName || session.userName || session.email}}\n                    </button>\n                    <div :class=\"['dropdown-menu',{show:showUserPopup}]\" style=\"top:45px;left:auto\">\n                        <a class=\"dropdown-item\" href=\"javascript:void(0)\" @click=\"logout()\">Sign Out</a>\n                    </div>            \n                </div>\n            </div>\n        \n        </span>\n        <div v-if=\"showAuthDialog\" id=\"signInModal\" class=\"modal\" tabindex=\"-1\" role=\"dialog\" \n             :style=\"{ display:showAuthDialog?'block':'none', background:'rgba(0,0,0,.25)'}\">\n          <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n              <div class=\"modal-header\">\n                <h5 class=\"modal-title\">Sign into {{ appInfo.serviceName }}</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" @click=\"showAuthDialog=false\">\n                  <span aria-hidden=\"true\">&times;</span>\n                </button>\n              </div>\n              <div class=\"modal-body\">\n                <ul class=\"nav nav-pills mb-3\" id=\"pills-tab\" role=\"tablist\">\n                    <li class=\"nav-item\" v-if=\"hasProvider('credentials')\" @click=\"tab='credentials'\">\n                        <span :class=\"['nav-link', {active:activeTab('credentials')}]\">Credentials</span>\n                    </li>\n                    <li class=\"nav-item\" v-if=\"hasOAuth\" @click=\"tab='oauth'\">\n                        <span :class=\"['nav-link', {active:activeTab('oauth')}]\">OAuth</span>\n                    </li>\n                    <li class=\"nav-item\" v-if=\"hasBearer\" @click=\"tab='bearer'\">\n                        <span :class=\"['nav-link', {active:activeTab('bearer')}]\">Token</span>\n                    </li>\n                    <li class=\"nav-item\" v-if=\"hasSession\" @click=\"tab='session'\">\n                        <span :class=\"['nav-link', {active:activeTab('session')}]\">Session</span>\n                    </li>\n                    <li class=\"nav-item\" v-if=\"hasAuthSecret\" @click=\"tab='authsecret'\">\n                        <span :class=\"['nav-link', {active:activeTab('authsecret')}]\">AuthSecret</span>\n                    </li>\n                </ul>\n                <div class=\"tab-content\" id=\"pills-tabContent\">\n                    <div v-if=\"hasProvider('credentials')\" :class=\"['tab-pane', {active:activeTab('credentials')}]\" id=\"pills-credentials\" role=\"tabpanel\">\n                        <credentials :slug=\"slug\" @done=\"showAuthDialog=false\" />\n                    </div>\n                    <div v-if=\"hasOAuth\" :class=\"['tab-pane', {active:activeTab('oauth')}]\" id=\"pills-oauth\" role=\"tabpanel\">\n                        <oauth-secret :slug=\"slug\" :providers=\"oauthProviders\" @done=\"showAuthDialog=false\" />\n                    </div>\n                    <div v-if=\"hasBearer\" :class=\"['tab-pane', {active:activeTab('bearer')}]\" id=\"pills-bearer\" role=\"tabpanel\">\n                        <bearer-token :slug=\"slug\" @done=\"showAuthDialog=false\" />\n                    </div>\n                    <div v-if=\"hasSession\" :class=\"['tab-pane', {active:activeTab('session')}]\" id=\"pills-session\" role=\"tabpanel\">\n                        <session-id :slug=\"slug\" @done=\"showAuthDialog=false\" />\n                    </div>\n                    <div v-if=\"hasAuthSecret\" :class=\"['tab-pane', {active:activeTab('authsecret')}]\" id=\"pills-authsecret\" role=\"tabpanel\">\n                        <auth-secret :slug=\"slug\" @done=\"showAuthDialog=false\" />\n                    </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>        \n    </div>",})],Auth);return Auth;}(vue_property_decorator_1.Vue));exports.Auth=Auth;exports.default=Auth;vue_property_decorator_1.Vue.component('auth',Auth);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var OAuthSecret=(function(_super){__extends(OAuthSecret,_super);function OAuthSecret(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;_this.showOAuthModal='';_this.tab='session';_this.tokenProvider='';_this.token='';return _this;}
Object.defineProperty(OAuthSecret.prototype,"iframeProviders",{get:function(){return this.providers.filter(function(x){var _a;return x.meta&&((_a=x.meta.allows)===null||_a===void 0?void 0:_a.indexOf('embed'))>=0;});},enumerable:true,configurable:true});Object.defineProperty(OAuthSecret.prototype,"oauthModalProvider",{get:function(){return this.showOAuthModal==='session'?'':this.showOAuthModal;},enumerable:true,configurable:true});Object.defineProperty(OAuthSecret.prototype,"includesOAuthTokens",{get:function(){return this.app.plugins.auth.includesOAuthTokens;},enumerable:true,configurable:true});OAuthSecret.prototype.activeTab=function(tab){return this.tab==tab;};Object.defineProperty(OAuthSecret.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(OAuthSecret.prototype,"enabled",{get:function(){return this.app&&this.app.plugins.auth;},enumerable:true,configurable:true});OAuthSecret.prototype.modalDone=function(e){if(e&&Object.keys(e).length==1){this.tokenProvider=Object.keys(e)[0];this.token=e[this.tokenProvider];if(this.tokenProvider==='sessionid'){this.tokenProvider='session';}}
this.showOAuthModal='';};OAuthSecret.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!(this.tokenProvider&&this.token)){return[2];}
return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,provider:this.tokenProvider,accessToken:this.token,}))];case 1:response=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:response});this.$emit('done');return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],OAuthSecret.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:[]})],OAuthSecret.prototype,"providers",void 0);OAuthSecret=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\">\n        <form ref=\"form\" @submit.prevent=\"\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary except=\"token\" :responseStatus=\"responseStatus\" />\n            </div>\n            <div class=\"form-group\">\n                <p class=\"text-muted\">\n                    1. Sign In\n                </p>\n                <div class=\"mb-3\">\n                    <button class=\"btn btn-outline-primary btn-sm mr-1\" @click=\"showOAuthModal='session'\">session</button>\n                    <button v-for=\"x in iframeProviders\" class=\"btn btn-outline-primary btn-sm mr-1\" @click=\"showOAuthModal=x.name\">{{x.name}}</button>\n                </div>\n                \n                <auth-modal v-if=\"showOAuthModal\" :slug=\"slug\" :provider=\"oauthModalProvider\" @done=\"modalDone\" />\n                \n                <p class=\"text-muted\">\n                    2. Copy Session Id \n                    <span v-if=\"includesOAuthTokens\">or OAuth AccessToken</span>\n                </p>\n                <ul v-if=\"tokenProvider\" class=\"nav nav-pills mb-3\" id=\"pills-tab\" role=\"tablist\">\n                    <li class=\"nav-item btn-outline-secondary\">\n                        <span :class=\"['nav-link','btn-outline-secondary', {active:true}]\">{{tokenProvider}}</span>\n                    </li>\n                </ul>\n                <div v-if=\"tokenProvider\" class=\"tab-content\" id=\"pills-tabContent\">\n                    <div :class=\"['tab-pane', {active:true}]\" id=\"pills-session\" role=\"tabpanel\">\n                        <div class=\"form-group\">\n                            <v-input id=\"token\" v-model=\"token\" placeholder=\"Token\" :responseStatus=\"responseStatus\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <button class=\"btn btn-lg btn-outline-primary\" @click=\"submit\">Login</button>\n                        </div>\n                    </div>\n                </div>               \n            </div>\n        </form>\n    </div>",})],OAuthSecret);return OAuthSecret;}(vue_property_decorator_1.Vue));exports.OAuthSecret=OAuthSecret;exports.default=OAuthSecret;vue_property_decorator_1.Vue.component('oauth-secret',OAuthSecret);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var SessionId=(function(_super){__extends(SessionId,_super);function SessionId(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.showSessionModal=false;_this.loading=false;_this.responseStatus=null;_this.token='';return _this;}
Object.defineProperty(SessionId.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(SessionId.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'auth');},enumerable:true,configurable:true});SessionId.prototype.modalDone=function(e){this.token=e&&e.sessionid||'';this.showSessionModal=false;};SessionId.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.post(new dtos_1.SiteAuthenticate({slug:this.slug,provider:'session',accessToken:this.token,}))];case 1:response=_a.sent();shared_1.bus.$emit('appSession',{slug:this.slug,result:response});this.$emit('done');return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],SessionId.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:false})],SessionId.prototype,"hideViewSession",void 0);SessionId=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\">\n        <form ref=\"form\" @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary except=\"token\" :responseStatus=\"responseStatus\" />\n            </div>\n            <div class=\"form-group\">\n                <span v-if=\"!hideViewSession\" class=\"btn btn-sm btn-outline-primary mb-2\" @click=\"showSessionModal=!showSessionModal\">session</span>\n                <auth-modal v-if=\"showSessionModal\" :slug=\"slug\" @done=\"modalDone\" />\n                <v-input id=\"token\" v-model=\"token\" placeholder=\"Session Id\" :responseStatus=\"responseStatus\" \n                         help=\"Copy your Authenticated Session Id\" />\n            </div>\n            <div class=\"form-group\">\n                <button type=\"submit\" class=\"btn btn-lg btn-outline-primary\">Login</button>\n            </div>\n        </form>\n    </div>",})],SessionId);return SessionId;}(vue_property_decorator_1.Vue));exports.SessionId=SessionId;exports.default=SessionId;vue_property_decorator_1.Vue.component('session-id',SessionId);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var CreateModal=(function(_super){__extends(CreateModal,_super);function CreateModal(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.value='';_this.model={};_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(CreateModal.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(CreateModal.prototype,"enabled",{get:function(){return this.app&&this.app.plugins.autoQuery;},enumerable:true,configurable:true});Object.defineProperty(CreateModal.prototype,"size",{get:function(){return this.op.request.properties.length>10?'md':'lg';},enumerable:true,configurable:true});CreateModal.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){shared_1.log('CreateModal.mounted()');this.type.properties.forEach(function(f,i){_this.$set(_this.model,f.name,shared_1.defaultValue(f));});this.$nextTick(function(){var _a;(_a=document.querySelector('#createModal input:first-child'))===null||_a===void 0?void 0:_a.select();});return[2];});});};CreateModal.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var args,k;return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('CreateModal.submit()',this);args=[];for(k in this.model){args.push(k);args.push(this.model[k]);}
return[4,shared_1.postSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:this.op.request.name,args:args}))];case 1:_a.sent();this.$emit('done',this.model);return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],CreateModal.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],CreateModal.prototype,"op",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],CreateModal.prototype,"type",void 0);CreateModal=__decorate([vue_property_decorator_1.Component({template:"<div id=\"createModal\" class=\"modal-inline\" tabindex=\"-1\" role=\"dialog\" @keyup.esc=\"$emit('done')\">\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h5 class=\"modal-title\">\n            New {{type.name}}\n        </h5>\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" @click=\"$emit('done')\">\n          <span aria-hidden=\"true\">&times;</span>\n        </button>\n      </div>\n      <div class=\"modal-body\">\n        <form @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary :except=\"type.properties.map(x => x.name)\" :responseStatus=\"responseStatus\" />\n            </div>        \n            <div v-for=\"f in op.request.properties\" :key=\"f.name\" class=\"form-group\">\n                <v-input type=\"text\" :id=\"f.name\" v-model=\"model[f.name]\" :placeholder=\"f.name\" :responseStatus=\"responseStatus\" \n                         :inputClass=\"['form-control-' + size]\" :help=\"f.name\" />                \n            </div>\n            <div class=\"form-group text-right\">\n                <span class=\"btn btn-link\" @click=\"$emit('done')\">Close</span>\n                <button type=\"submit\" class=\"btn btn-primary\">Create {{type.name}}</button>\n            </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</div>",})],CreateModal);return CreateModal;}(vue_property_decorator_1.Vue));exports.CreateModal=CreateModal;exports.default=CreateModal;vue_property_decorator_1.Vue.component('create-modal',CreateModal);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var client_1=require("@servicestack/client");var EditModal=(function(_super){__extends(EditModal,_super);function EditModal(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.value='';_this.model={};_this.confirmDelete=false;_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(EditModal.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(EditModal.prototype,"enabled",{get:function(){return this.app&&this.app.plugins.autoQuery;},enumerable:true,configurable:true});Object.defineProperty(EditModal.prototype,"size",{get:function(){var _a;return((_a=(this.updateOp||this.deleteOp))===null||_a===void 0?void 0:_a.request.properties.length)>10?'md':'lg';},enumerable:true,configurable:true});Object.defineProperty(EditModal.prototype,"labelButton",{get:function(){return this.type.name.length<=13?"Update "+this.type.name:"Update";},enumerable:true,configurable:true});EditModal.prototype.fieldValue=function(f){return shared_1.editValue(f,this.model[f.name]);};EditModal.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){shared_1.log('CreateModal.mounted()');this.type.properties.forEach(function(f,i){_this.$set(_this.model,f.name,shared_1.editValue(f,client_1.getField(_this.row,f.name)));});this.$nextTick(function(){var _a;(_a=document.querySelector('#createModal input:first-child'))===null||_a===void 0?void 0:_a.select();});return[2];});});};EditModal.prototype.deleteRow=function(){return __awaiter(this,void 0,void 0,function(){var pk,pkValue;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:pk=this.type.properties.find(function(x){return x.isPrimaryKey;});pkValue=pk&&client_1.getField(this.row,pk.name);return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var args;return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('EditModal.deleteRow()');if(!pkValue)
throw{errorCode:'InvalidState',message:"Could not resolve Primary Key"};args=[pk.name,pkValue];return[4,shared_1.deleteSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:this.deleteOp.request.name,args:args}))];case 1:_a.sent();this.$emit('done',this.model);return[2];}});});})];case 1:_a.sent();return[2];}});});};EditModal.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var args,k;return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('EditModal.submit()',this);args=[];for(k in this.model){args.push(k);args.push(this.model[k]);}
return[4,shared_1.postSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:this.updateOp.request.name,args:args}))];case 1:_a.sent();this.$emit('done',this.model);return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],EditModal.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],EditModal.prototype,"updateOp",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],EditModal.prototype,"deleteOp",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],EditModal.prototype,"type",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],EditModal.prototype,"field",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],EditModal.prototype,"row",void 0);EditModal=__decorate([vue_property_decorator_1.Component({template:"<div id=\"editModal\" class=\"modal-inline\" tabindex=\"-1\" role=\"dialog\" @keyup.esc=\"$emit('done')\" title=\"\">\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h5 class=\"modal-title\">\n            Edit {{type.name}}\n        </h5>\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" @click=\"$emit('done')\">\n          <span aria-hidden=\"true\">&times;</span>\n        </button>\n      </div>\n      <div class=\"modal-body\">\n        <form @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n            <div class=\"form-group\">\n                <error-summary :except=\"type.properties.map(x => x.name)\" :responseStatus=\"responseStatus\" />\n            </div>        \n            <div v-for=\"f in type.properties\" :key=\"f.name\" class=\"form-group\">\n                <span v-if=\"!updateOp || f.isPrimaryKey\" :class=\"['disabled',size,'ml-2']\">{{fieldValue(f)}}</span>\n                <v-input v-else type=\"text\" :id=\"f.name\" v-model=\"model[f.name]\" :placeholder=\"f.name\" :responseStatus=\"responseStatus\" \n                         :inputClass=\"['form-control-' + size]\" :help=\"f.name\" />                \n            </div>\n            <div class=\"form-group text-right\">\n                <span class=\"btn btn-link\" @click=\"$emit('done')\">close</span>\n                <button type=\"submit\" class=\"btn btn-primary\">{{labelButton}}</button>\n            </div>\n            <div v-if=\"deleteOp\" class=\"confirm-delete\" style=\"margin:-54px 0 0 20px\">\n                <input id=\"chkDelete\" type=\"checkbox\" class=\"form-check-input\" @change=\"confirmDelete=!confirmDelete\"/> \n                <label for=\"chkDelete\" class=\"form-check-label\">confirm</label>\n                <button class=\"btn btn-danger \" @click.prevent=\"confirmDelete && deleteRow()\" :disabled=\"!confirmDelete\">Delete</button>\n            </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</div>",})],EditModal);return EditModal;}(vue_property_decorator_1.Vue));exports.EditModal=EditModal;exports.default=EditModal;vue_property_decorator_1.Vue.component('edit-modal',EditModal);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var client_1=require("@servicestack/client");var EventsModal=(function(_super){__extends(EventsModal,_super);function EventsModal(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.results=[];_this.expandIds=[];_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(EventsModal.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(EventsModal.prototype,"plugin",{get:function(){var _a;return(_a=this.app)===null||_a===void 0?void 0:_a.plugins.autoQuery;},enumerable:true,configurable:true});Object.defineProperty(EventsModal.prototype,"enabled",{get:function(){var _a;return this.plugin.crudEventsServices&&shared_1.store.hasRole(this.slug,(_a=this.plugin)===null||_a===void 0?void 0:_a.accessRole);},enumerable:true,configurable:true});Object.defineProperty(EventsModal.prototype,"pk",{get:function(){return this.type.properties.find(function(x){return x.isPrimaryKey;});},enumerable:true,configurable:true});EventsModal.prototype.dateFmt=function(dateStr){return client_1.dateFmt(client_1.toDate(dateStr))+" "+client_1.timeFmt12(client_1.toDate(dateStr));};EventsModal.prototype.expanded=function(id){return this.expandIds.indexOf(id)>=0;};EventsModal.prototype.toggle=function(id){if(this.expanded(id)){this.expandIds=this.expandIds.filter(function(x){return x!=id;});}
else{this.expandIds.push(id);}};EventsModal.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!this.enabled)
return[2];shared_1.log('EventsModal.mounted()',this.slug,this.type.name,this.id);return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var response,obj;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.getSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:'GetCrudEvents',args:['model',this.type.name,'modelId',this.id]}))];case 1:response=_a.sent();obj=JSON.parse(response);this.results=obj.results.reverse();return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:null})],EventsModal.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop()],EventsModal.prototype,"type",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],EventsModal.prototype,"id",void 0);EventsModal=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"enabled\" id=\"eventsModal\" class=\"modal-inline\" tabindex=\"-1\" role=\"dialog\" @keyup.esc=\"$emit('done')\">\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h5 class=\"modal-title\">\n            {{type.name}} Events\n        </h5>\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" @click=\"$emit('done')\">\n          <span aria-hidden=\"true\">&times;</span>\n        </button>\n      </div>\n      <div class=\"modal-body\">\n        <error-summary :responseStatus=\"responseStatus\" />\n        <dl class=\"h-kvp mb-3\">\n            <dt>{{pk.name}}</dt>\n            <dd>{{id}}</dd>\n        </dl>\n        <div v-for=\"x in results\" :key=\"x.id\" class=\"event-line\">\n            <i v-if=\"!expanded(x.id)\" class=\"svg svg-chevron-right svg-btn svg-md\" title=\"expand\" @click=\"toggle(x.id)\"></i>\n            <i v-else class=\"svg svg-chevron-down svg-btn svg-md\" title=\"collapse\" @click=\"toggle(x.id)\"></i>\n            <ul class=\"event summary\" @click=\"toggle(x.id)\">\n                <li class=\"type\">{{x.eventType | upper}}</li>\n                <li class=\"by\"><b><i>[{{x.userAuthId}}]</i> {{x.userAuthName}}</b></li>\n                <li class=\"on\"><b :title=\"dateFmt(x.eventDate)\">{{dateFmt(x.eventDate)}}</b></li>\n            </ul>\n            <div v-if=\"expanded(x.id)\" class=\"event-detail\">\n                <ul class=\"event\">\n                    <li class=\"op\">{{x.requestType}}</li>\n                    <li class=\"ip\"><span>ip</span>{{x.remoteIp}}</li>\n                </ul>\n                <jsonviewer :json=\"x.requestBody\"/>\n            </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>",})],EventsModal);return EventsModal;}(vue_property_decorator_1.Vue));exports.EventsModal=EventsModal;exports.default=EventsModal;vue_property_decorator_1.Vue.component('events-modal',EventsModal);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};var __spreadArrays=(this&&this.__spreadArrays)||function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)
for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)
r[k]=a[j];return r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var client_1=require("@servicestack/client");var AutoQuery=(function(_super){__extends(AutoQuery,_super);function AutoQuery(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.txtFilter='';_this.searchField='';_this.searchType='';_this.searchText='';_this.conditions=[];_this.responseJson='';_this.response=null;_this.results=[];_this.eventIds=null;_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(AutoQuery.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"slug",{get:function(){return this.$route.params.slug;},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"op",{get:function(){return this.$route.query.op;},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"windowStyles",{get:function(){return shared_1.collapsed(this.slug,'footer')?'collapse-footer':'';},enumerable:true,configurable:true});AutoQuery.prototype.onUrlChange=function(newVal){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.reset()];case 1:_a.sent();return[2];}});});};AutoQuery.prototype.resetQuery=function(){var _a,_b,_c;return __awaiter(this,void 0,void 0,function(){var pk,convention,field;var _this=this;return __generator(this,function(_d){switch(_d.label){case 0:pk=(_a=this.model)===null||_a===void 0?void 0:_a.properties.find(function(x){return x.isPrimaryKey;});this.searchField=this.$route.query.field||((_b=pk)===null||_b===void 0?void 0:_b.name)||'';this.searchType=this.$route.query.type||'%';this.searchText=this.$route.query.q||'';convention=(_c=this.plugin)===null||_c===void 0?void 0:_c.viewerConventions.find(function(c){return c.value===_this.searchType;});if(!convention)return[3,2];field=convention.value.replace("%",this.searchField);return[4,this.search([field,' '])];case 1:_d.sent();_d.label=2;case 2:return[2];}});});};AutoQuery.prototype.reset=function(){var _a,_b,_c,_d,_e,_f;return __awaiter(this,void 0,void 0,function(){var pk,queryPrefs,customQuery;return __generator(this,function(_g){switch(_g.label){case 0:shared_1.log('reset',this.op,this.modelRef,this.model);this.responseStatus=null;this.responseJson='';pk=(_a=this.model)===null||_a===void 0?void 0:_a.properties.find(function(x){return x.isPrimaryKey;});queryPrefs=(((_b=shared_1.store.getAppPrefs(this.slug))===null||_b===void 0?void 0:_b.queryConditions[this.op])||[])[0];this.searchField=this.$route.query.field||((_c=queryPrefs)===null||_c===void 0?void 0:_c.searchField)||((_d=pk)===null||_d===void 0?void 0:_d.name)||'';this.searchType=this.$route.query.type||((_e=queryPrefs)===null||_e===void 0?void 0:_e.searchType)||'%';this.searchText=this.$route.query.q||((_f=queryPrefs)===null||_f===void 0?void 0:_f.searchText)||'';customQuery=this.$route.query.field||this.$route.query.type||this.$route.query.q;if(!(customQuery||queryPrefs))return[3,2];return[4,this.submit()];case 1:_g.sent();return[3,4];case 2:return[4,this.search([])];case 3:_g.sent();_g.label=4;case 4:return[2];}});});};Object.defineProperty(AutoQuery.prototype,"site",{get:function(){return shared_1.store.getSite(this.slug);},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"api",{get:function(){var _a;return(_a=this.app)===null||_a===void 0?void 0:_a.api;},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"plugin",{get:function(){var _a;return(_a=shared_1.store.getApp(this.slug))===null||_a===void 0?void 0:_a.plugins.autoQuery;},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'autoquery');},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"enableEvents",{get:function(){var _a;return((_a=this.plugin)===null||_a===void 0?void 0:_a.crudEventsServices)&&this.store.hasRole(this.slug,this.plugin.accessRole);},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"modelRef",{get:function(){var _this=this;var _a,_b;return(_b=(_a=this.api)===null||_a===void 0?void 0:_a.operations.find(function(x){return x.request.name===_this.$route.query.op;}))===null||_b===void 0?void 0:_b.dataModel;},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"model",{get:function(){return shared_1.store.getType(this.slug,this.modelRef);},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"modelProps",{get:function(){var _a;return __spreadArrays([{key:'',value:'Columns...'}],((_a=this.model)===null||_a===void 0?void 0:_a.properties.map(function(x){return({key:x.name,value:x.name});}))||[]);},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"viewerConventions",{get:function(){var _a;return __spreadArrays([{key:'',value:'Filters...'}],(((_a=this.plugin)===null||_a===void 0?void 0:_a.viewerConventions.map(function(x){return({key:x.value,value:x.name});}))||[]));},enumerable:true,configurable:true});AutoQuery.prototype.matchesType=function(x,y){return shared_1.matchesType(x,y);};AutoQuery.prototype.typeKey=function(type){return(type.namespace||'')+'.'+type.name;};Object.defineProperty(AutoQuery.prototype,"operations",{get:function(){var _this=this;var _a;if(!this.app)
return[];return((_a=this.api)===null||_a===void 0?void 0:_a.operations.filter(function(op){return shared_1.matchesType(op.dataModel,_this.modelRef);}))||[];},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"queryOps",{get:function(){return this.operations.filter(shared_1.isQuery);},enumerable:true,configurable:true});AutoQuery.prototype.filterOperations=function(fn){var _this=this;var _a;if(!this.app)
return[];var to=[];var typesMap=shared_1.store.appTypes[this.slug];var existingKeys={};var search=this.txtFilter.toLowerCase();(_a=this.api)===null||_a===void 0?void 0:_a.operations.forEach(function(op){if(!op.dataModel)
return;var typeKey=_this.typeKey(op.request);if(existingKeys[typeKey])
return;existingKeys[typeKey]=true;var type=typesMap[typeKey];if(type){if(type.name.toLowerCase().indexOf(search)>=0){if(!fn||fn(op,type))
to.push(op);}}
else{console.warn('Type does not exist',op.dataModel);}});to.sort(function(x,y){return x.dataModel.name.localeCompare(y.dataModel.name);});return to;};Object.defineProperty(AutoQuery.prototype,"autoQueryTables",{get:function(){return this.filterOperations(function(op,table){return shared_1.isQuery(op);});},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"accessibleAutoQueryTables",{get:function(){var _this=this;return this.filterOperations(function(op,table){return shared_1.isQuery(op)&&shared_1.canAccess(_this.slug,op);});},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"crudOperations",{get:function(){var _this=this;return this.filterOperations(function(op,table){return shared_1.isCrud(op)&&shared_1.matchesType(op.dataModel,_this.modelRef);});},enumerable:true,configurable:true});Object.defineProperty(AutoQuery.prototype,"selectedCondition",{get:function(){return!this.searchField||!this.searchType||!this.searchText?null:{searchField:this.searchField,searchType:this.searchType,searchText:this.searchText};},enumerable:true,configurable:true});AutoQuery.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.loadSite(this.slug)];case 1:_a.sent();return[4,this.reset()];case 2:_a.sent();shared_1.bus.$on('signedin',function(){_this.reset();});return[2];}});});};AutoQuery.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('submit',this.selectedCondition);if(!this.selectedCondition)
return[2];return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var searchArgs;return __generator(this,function(_a){switch(_a.label){case 0:searchArgs=this.searchArgs();searchArgs.push({include:'total'});return[4,this.search(shared_1.toInvokeArgs(searchArgs))];case 1:return[2,_a.sent()];}});});})];case 1:_a.sent();return[2];}});});};AutoQuery.prototype.search=function(invokeArgs){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!this.op)
return[2];return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var request,_a;return __generator(this,function(_b){switch(_b.label){case 0:request=new dtos_1.SiteInvoke({slug:this.slug,request:this.op,args:invokeArgs});shared_1.log('siteInvoke',request);_a=this;return[4,shared_1.getSiteInvoke(request)];case 1:_a.responseJson=_b.sent();this.response=JSON.parse(this.responseJson);this.results=this.response&&(this.response.results||this.response.Results);shared_1.bus.$emit('appPrefs',{slug:this.slug,request:this.op,queryConditions:this.allConditions});return[4,this.loadEvents()];case 2:_b.sent();return[2];}});});})];case 1:_a.sent();return[2];}});});};AutoQuery.prototype.loadEvents=function(){var _a;return __awaiter(this,void 0,void 0,function(){var pk,pkValues,ids,response,obj;return __generator(this,function(_b){switch(_b.label){case 0:if(!this.enableEvents)
return[2];pk=(_a=this.model)===null||_a===void 0?void 0:_a.properties.find(function(x){return x.isPrimaryKey;});pkValues=pk!=null?this.results.map(function(x){return client_1.getField(x,pk.name);}).filter(function(x){return x!=null;}):[];if(pkValues.length==0)
return[2];ids=pkValues.join(',');return[4,shared_1.postSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:'CheckCrudEvents',args:['model',this.model.name,'ids',ids]}))];case 1:response=_b.sent();shared_1.log('loadEvents',response);obj=JSON.parse(response);this.eventIds=obj.results;return[2];}});});};AutoQuery.prototype.isValidCondition=function(){return this.searchField&&this.searchType&&this.searchText&&(this.searchType.toLowerCase()!=='between'||(this.searchText.indexOf(',')>0&&this.searchText.indexOf(',')<this.searchText.length-1));};Object.defineProperty(AutoQuery.prototype,"allConditions",{get:function(){var conditions=__spreadArrays((this.conditions||[]));if(this.selectedCondition){conditions.push(this.selectedCondition);}
return conditions;},enumerable:true,configurable:true});AutoQuery.prototype.searchArgs=function(){var _this=this;var args=[];this.allConditions.forEach(function(condition){var _a;var _b;var searchField=condition.searchField,searchType=condition.searchType,searchText=condition.searchText;var convention=(_b=_this.plugin)===null||_b===void 0?void 0:_b.viewerConventions.find(function(c){return c.value===searchType;});if(convention){var field=convention.value.replace("%",searchField);args.push((_a={},_a[field]=searchText,_a));}});return args;};AutoQuery.prototype.handleError=function(status){this.responseStatus=status;};__decorate([vue_property_decorator_1.Prop({default:''})],AutoQuery.prototype,"name",void 0);__decorate([vue_property_decorator_1.Watch('$route',{immediate:true,deep:true})],AutoQuery.prototype,"onUrlChange",null);AutoQuery=__decorate([vue_property_decorator_1.Component({template:"<section v-if=\"enabled\" id=\"autoquery\" :class=\"['grid-layout',windowStyles]\">\n\n        <header id=\"header\">\n            <h1 v-if=\"site\">\n                <nav class=\"site-breadcrumbs\">\n                    <ol class=\"breadcrumb\">\n                        <li class=\"breadcrumb-item\">\n                            <router-link to=\"/\"><i class=\"svg-home svg-3x mb-1\" title=\"home\" /></router-link>\n                        </li>\n                        <li :class=\"['breadcrumb-item',{active:!model}]\">\n                            <img v-if=\"site.iconUrl\" :src=\"site.iconUrl\" class=\"sq-3x mb-1\">\n                            <i v-else class=\"svg db-dark svg-3x mb-1\" \n                               /><router-link v-if=\"model\" to=\"?\">{{site.name}}</router-link>                \n                            <span v-else>{{site.name}}</span>\n                        </li>\n                        <li v-if=\"model\" class=\"breadcrumb-item active\">{{$route.query.op}}</li>\n                        <li v-if=\"loading\"><i class=\"svg-loading svg-lg ml-2 mb-1\" title=\"loading...\" /></li>\n                    </ol>\n                </nav>\n            </h1>\n            <h1 v-else-if=\"loading\">\n              <i class=\"fab fa-loading\"></i>\n              Loading...\n            </h1>\n            <div v-else-if=\"responseStatus\">\n                <error-summary :responseStatus=\"responseStatus\" />\n                <router-link to=\"/\">&lt; back to sites</router-link>\n            </div>\n            <auth id=\"auth\" v-if=\"site && app\" :slug=\"slug\" feature=\"autoquery\" :op=\"op\" /> \n        </header>\n        \n        <nav v-if=\"app\" id=\"left\">\n            <div id=\"nav-filter\">\n                <i v-if=\"txtFilter\" class=\"text-close\" style=\"position:absolute;margin:0 0 0 265px;\" title=\"clear\" @click=\"txtFilter=''\"></i>\n                <v-input v-model=\"txtFilter\" id=\"txtFilter\" placeholder=\"filter\" inputClass=\"form-control\" />\n            </div>\n            <div id=\"sidebar\" class=\"\">\n                <div class=\"pl-2\">\n                    <div v-for=\"op in accessibleAutoQueryTables\" :key=\"typeKey(op.request)\" \n                        :class=\"['datamodel',{selected:matchesType(op.dataModel,model)}]\" :title=\"op.dataModel?.name\">\n                        <router-link :to=\"{ query: { op:op.request.name } }\">{{op.dataModel?.name}}</router-link>\n                    </div>\n                </div>\n            </div>\n        </nav>\n        \n        <main v-if=\"app\">\n            <div v-if=\"model\" class=\"query-form\">\n                <div class=\"tab-content\" id=\"v-pills-tabContent\">\n                  <div class=\"tab-pane fade show active\" id=\"v-pills-home\" role=\"tabpanel\" aria-labelledby=\"v-pills-home-tab\">\n                    <form class=\"form-inline\" @submit.prevent=\"submit\">\n                    <table>\n                    <tr>\n                        <td>\n                            <v-select id=\"listColumns\" :values=\"modelProps\" :value=\"searchField\" :responseStatus=\"responseStatus\"\n                                      v-model=\"searchField\" selectClass=\"custom-select\">\n                            </v-select>\n                        </td>\n                        <td>\n                            <v-select id=\"listFilters\" :values=\"viewerConventions\" :value=\"searchType\" :responseStatus=\"responseStatus\"\n                                      v-model=\"searchType\" selectClass=\"custom-select mx-2\">\n                            </v-select>                                \n                        </td>\n                        <td>\n                            <v-input v-model=\"searchText\" placeholder=\"value\" class=\"\" inputClass=\"form-control\" />\n                        </td>\n                        <td>\n                            <button type=\"submit\" :disabled=\"!selectedCondition\" class=\"btn btn-outline-primary ml-1\" title=\"Search\">\n                                Search\n                            </button>\n                        </td>\n                        <td>\n                            <i v-if=\"selectedCondition\" class=\"text-close ml-2\" style=\"line-height:.5em\" title=\"reset query\" @click=\"resetQuery()\"/>\n                        </td>\n                    </tr>\n                    </table>\n                    </form>\n                  </div>\n                </div>\n            </div>\n            <div v-if=\"model && response && !responseStatus\" class=\"main-container\">\n                <results :slug=\"slug\" :results=\"results\" :type=\"model\" :crud=\"crudOperations\" :eventIds=\"eventIds\" @refresh=\"reset()\" />\n            </div>\n            <div v-else-if=\"responseStatus\"><error-view :responseStatus=\"responseStatus\" class=\"mt-5\" /></div>\n        </main>\n        \n        <Footer v-if=\"app\" :slug=\"slug\"/>\n        \n    </section>\n    <no-plugin v-else :slug=\"slug\" plugin=\"autoquery\" />",})],AutoQuery);return AutoQuery;}(vue_property_decorator_1.Vue));exports.AutoQuery=AutoQuery;exports.default=AutoQuery;vue_property_decorator_1.Vue.component('autoquery',AutoQuery);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var client_1=require("@servicestack/client");var PartialModal=(function(_super){__extends(PartialModal,_super);function PartialModal(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.value='';_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(PartialModal.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(PartialModal.prototype,"enabled",{get:function(){return this.app&&this.app.plugins.autoQuery;},enumerable:true,configurable:true});Object.defineProperty(PartialModal.prototype,"modalStyle",{get:function(){return({display:'block',top:(this.y-10)+'px',left:(this.x-20)+'px',position:'absolute',});},enumerable:true,configurable:true});PartialModal.prototype.modalKeyDown=function(e){if(e.key=="Escape"){this.$emit('done');}};PartialModal.prototype.beforeDestroy=function(){window.removeEventListener('keydown',this.modalKeyDown);};Object.defineProperty(PartialModal.prototype,"origValue",{get:function(){return client_1.getField(this.row,this.field);},enumerable:true,configurable:true});Object.defineProperty(PartialModal.prototype,"dirty",{get:function(){return this.value!=this.origValue;},enumerable:true,configurable:true});PartialModal.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){window.addEventListener('keydown',this.modalKeyDown);this.value=this.origValue;shared_1.log('PartialModal.mounted()');return[2];});});};PartialModal.prototype.submit=function(){if(this.dirty){shared_1.log('saving...',this.value,this.dirty);this.$emit('done',this.value);}};__decorate([vue_property_decorator_1.Prop({default:null})],PartialModal.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],PartialModal.prototype,"type",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],PartialModal.prototype,"row",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],PartialModal.prototype,"field",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],PartialModal.prototype,"x",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],PartialModal.prototype,"y",void 0);PartialModal=__decorate([vue_property_decorator_1.Component({template:"<div id=\"partialModal\" class=\"modal-mini\" tabindex=\"-1\" role=\"dialog\" :style=\"modalStyle\">\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-body\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" @click=\"$emit('done')\">\n            <span aria-hidden=\"true\">&times;</span>\n        </button>\n        <form @submit.prevent=\"submit\">\n            <v-input v-model=\"value\" :label=\"field\" inputClass=\"md\" />\n            <i v-if=\"dirty\" class=\"svg done-success svg-md svg-btn\" title=\"save\" @click=\"submit()\" style=\"float:right;margin:-27px 5px 0 0;\"/>\n        </form>\n      </div>\n    </div>\n  </div>\n</div>",})],PartialModal);return PartialModal;}(vue_property_decorator_1.Vue));exports.PartialModal=PartialModal;exports.default=PartialModal;vue_property_decorator_1.Vue.component('partial-modal',PartialModal);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_1=require("vue");var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var client_1=require("@servicestack/client");var FormatString=(function(_super){__extends(FormatString,_super);function FormatString(){return _super!==null&&_super.apply(this,arguments)||this;}
Object.defineProperty(FormatString.prototype,"lower",{get:function(){return(""+this.value).toLowerCase();},enumerable:true,configurable:true});Object.defineProperty(FormatString.prototype,"isUrl",{get:function(){return typeof this.value=="string"&&this.value.startsWith('http');},enumerable:true,configurable:true});Object.defineProperty(FormatString.prototype,"url",{get:function(){return typeof this.value=="string"&&this.value.substring(this.value.indexOf('://')+3);},enumerable:true,configurable:true});Object.defineProperty(FormatString.prototype,"format",{get:function(){return typeof this.value=="string"&&this.value.startsWith('/Date(')?client_1.toDateFmt(this.value):this.value;},enumerable:true,configurable:true});__decorate([vue_property_decorator_1.Prop({default:''})],FormatString.prototype,"value",void 0);FormatString=__decorate([vue_property_decorator_1.Component({template:"<a v-if=\"isUrl\" :href=\"value\" target=\"_blank\">{{url}}</a>\n     <i v-else-if=\"lower == 'false'\" class=\"svg svg-md bool-off-muted\"></i>\n     <i v-else-if=\"lower == 'true'\" class=\"svg svg-md bool-on-muted\"></i>\n     <span v-else>{{format}}</span>\n"})],FormatString);return FormatString;}(vue_1.default));vue_1.default.component('format',FormatString);var Results=(function(_super){__extends(Results,_super);function Results(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.loading=false;_this.responseStatus=null;_this.showCreate=false;_this.showEvents=false;_this.editingValue='';_this.editingRow=null;_this.editingField=null;_this.selectedField=null;_this.cancelBlur=false;return _this;}
Results.prototype.onUrlChange=function(newVal){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){this.resetEdit();this.show();return[2];});});};Object.defineProperty(Results.prototype,"bus",{get:function(){return shared_1.bus;},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"session",{get:function(){return shared_1.store.getSession(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"plugin",{get:function(){return shared_1.store.getApp(this.slug).plugins.autoQuery;},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"enableEvents",{get:function(){var _a;return this.plugin.crudEventsServices&&shared_1.store.hasRole(this.slug,(_a=this.plugin)===null||_a===void 0?void 0:_a.accessRole);},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"fields",{get:function(){return this.type.properties;},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"fieldNames",{get:function(){return this.type.properties.map(function(x){return x.name;});},enumerable:true,configurable:true});Results.prototype.show=function(tab,rowIndex){this.selectedField=null;this.showCreate=false;this.showEvents=false;this.editingRow=null;if(tab==='Create'){this.showCreate=true;}
else if(tab=='Edit'&&typeof rowIndex=="number"){this.editingRow=rowIndex;}
else if(tab=='Events'&&typeof rowIndex=="number"){this.selectedField=[rowIndex,this.fieldNames.length-1];this.showEvents=true;}};Results.prototype.handleDone=function(op,e){shared_1.log('handleDone',op,e);this.showCreate=false;this.showEvents=false;this.editingRow=null;if(e){this.$emit('refresh');}};Object.defineProperty(Results.prototype,"createOp",{get:function(){var _this=this;return this.crud.find(function(x){return shared_1.canAccess(_this.slug,x)&&x.request.implements.some(function(i){return i.name=="ICreateDb`1";});});},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"updateOp",{get:function(){var _this=this;return this.crud.find(function(x){return shared_1.canAccess(_this.slug,x)&&x.request.implements.some(function(i){return i.name=="IUpdateDb`1";});});},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"deleteOp",{get:function(){var _this=this;return this.crud.find(function(x){return shared_1.canAccess(_this.slug,x)&&x.request.implements.some(function(i){return i.name=="IDeleteDb`1";});});},enumerable:true,configurable:true});Results.prototype.isPartialField=function(f){return this.partialFields.indexOf(f)>=0;};Object.defineProperty(Results.prototype,"partialFields",{get:function(){var _this=this;var propNames=this.crud.filter(function(x){return shared_1.canAccess(_this.slug,x)&&x.request.implements.some(function(i){return i.name=="IPatchDb`1";});}).map(function(x){return shared_1.store.getType(_this.slug,x.dataModel);}).map(function(x){var _a;return(_a=x)===null||_a===void 0?void 0:_a.properties.filter(function(p){return!p.isPrimaryKey;}).map(function(p){return p.name;});}).reduce(function(a,b){var _a;return(_a=a)===null||_a===void 0?void 0:_a.concat(b||[]);},[]);return propNames||[];},enumerable:true,configurable:true});Results.prototype.hasAccessibleCrud=function(actions){var _this=this;var crudInterfaces=actions.map(function(x){return"I"+x+"Db`1";});return this.crud.some(function(x){var _a;return shared_1.canAccess(_this.slug,x)&&((_a=x.request.implements)===null||_a===void 0?void 0:_a.some(function(r){return crudInterfaces.indexOf(r.name)>=0;}));});};Results.prototype.hasCrud=function(actions){var crudInterfaces=actions.map(function(x){return"I"+x+"Db`1";});return this.crud.some(function(x){var _a;return(_a=x.request.implements)===null||_a===void 0?void 0:_a.some(function(r){return crudInterfaces.indexOf(r.name)>=0;});});};Results.prototype.humanize=function(s){return client_1.humanize(s);};Results.prototype.renderValue=function(o){return Array.isArray(o)?o.join(', '):typeof o=="undefined"?"":typeof o=="object"?JSON.stringify(o):o+"";};Object.defineProperty(Results.prototype,"createLabel",{get:function(){return"New "+this.type.name;},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"updateLabel",{get:function(){return"Edit "+this.type.name;},enumerable:true,configurable:true});Results.prototype.getField=function(o,name){return client_1.getField(o,name);};Object.defineProperty(Results.prototype,"canCreate",{get:function(){return true;},enumerable:true,configurable:true});Object.defineProperty(Results.prototype,"canUpdate",{get:function(){return false;},enumerable:true,configurable:true});Results.prototype.getId=function(row){return shared_1.getId(this.type,row);};Results.prototype.hasEvent=function(row){var id=""+shared_1.getId(this.type,row);var ret=id&&this.eventIds&&this.eventIds.indexOf(id)>=0;return ret;};Results.prototype.moveSelected=function(y,x){var _a;if(!this.selectedField)
return;if(((_a=document.activeElement)===null||_a===void 0?void 0:_a.tagName)=='INPUT')
return;if(y!=0){var prevY=this.selectedField[0];this.$set(this.selectedField,0,prevY+y>=this.results.length?0:prevY+y<0?this.results.length-1:prevY+y);}
if(x!=0){var prevX=this.selectedField[1];this.$set(this.selectedField,1,prevX+x>=this.fieldNames.length?0:prevX+x<0?this.fieldNames.length-1:prevX+x);}
if(typeof this.editingRow=='number'){this.editingRow=this.selectedField[0];}
if(this.showEvents&&!this.hasEvent(this.results[this.selectedField[0]])){this.showEvents=false;}};Results.prototype.onKeyDown=function(e){var _a;if(e.key=="Escape"){this.resetEdit();this.show('');}
else if(this.selectedField){if((_a=document.activeElement)===null||_a===void 0?void 0:_a.form)
return;if(!this.editingField&&e.key=="Enter"){this.editField(this.selectedField[0],this.selectedField[1]);}
else if(e.key=='ArrowUp'){this.moveSelected(-1,0);}
else if(e.key=='ArrowDown'){this.moveSelected(1,0);}
else if(e.key=='ArrowLeft'){this.moveSelected(0,-1);}
else if(e.key=='ArrowRight'){this.moveSelected(0,1);}
else if(e.key=='Home'){this.$set(this.selectedField,1,0);this.focusSelected();}
else if(e.key=='End'){this.$set(this.selectedField,1,this.fieldNames.length-1);this.focusSelected();}}};Results.prototype.focusSelected=function(){this.$nextTick(function(){var _a;return(_a=document.querySelector('.results td.selected'))===null||_a===void 0?void 0:_a.scrollIntoView();});};Results.prototype.beforeDestroy=function(){window.removeEventListener('keydown',this.onKeyDown);};Results.prototype.mounted=function(){window.addEventListener('keydown',this.onKeyDown);shared_1.log('Results.mounted()');};Results.prototype.isEditingRow=function(rowIndex){return this.editingRow===rowIndex;};Results.prototype.isEditingField=function(i,j){return this.editingField&&this.editingField[0]===i&&this.editingField[1]===j;};Object.defineProperty(Results.prototype,"dirty",{get:function(){return this.editingField&&this.editingValue!=client_1.getField(this.results[this.editingField[0]],this.fieldNames[this.editingField[1]]);},enumerable:true,configurable:true});Results.prototype.selectedRow=function(rowIndex){return this.selectedField&&this.selectedField[0]==rowIndex;};Results.prototype.selectedCell=function(rowIndex,fieldIndex){return this.selectedField&&this.selectedField[0]==rowIndex&&this.selectedField[1]==fieldIndex;};Results.prototype.selectField=function(rowIndex,fieldIndex){this.selectedField=[rowIndex,fieldIndex];};Results.prototype.editRow=function(rowIndex){this.handleDone();this.editingRow=rowIndex;this.selectedField=[rowIndex,0];};Results.prototype.editField=function(rowIndex,fieldIndex){var _a;if(!this.isPartialField(this.fieldNames[fieldIndex]))
return;(_a=window.getSelection())===null||_a===void 0?void 0:_a.removeAllRanges();this.editingField=[rowIndex,fieldIndex];this.editingValue=client_1.getField(this.results[rowIndex],this.fieldNames[fieldIndex]);this.$nextTick(function(){var _a;(_a=document.querySelector('.results .editing input'))===null||_a===void 0?void 0:_a.select();});};Results.prototype.onEditBlur=function(){var _this=this;this.cancelBlur=false;setTimeout(function(){if(!_this.cancelBlur){_this.cancelEdit();}},300);};Results.prototype.cancelEdit=function(){if(!this.editingField)
return;shared_1.log('cancelEdit');this.resetEdit();};Results.prototype.resetEdit=function(){this.responseStatus=null;this.editingField=null;this.editingValue='';};Results.prototype.findKey=function(rowIndex,updateField){var foundKey=Object.keys(this.results[rowIndex]).find(function(k){return client_1.normalizeKey(k)==client_1.normalizeKey(updateField);});if(foundKey)
return foundKey;for(var i=0;i<this.results.length;i++){foundKey=Object.keys(this.results[i]).find(function(k){return client_1.normalizeKey(k)==client_1.normalizeKey(updateField);});if(foundKey)
return foundKey;}
return client_1.toCamelCase(updateField);};Results.prototype.saveEdit=function(){var _a;return __awaiter(this,void 0,void 0,function(){var rowIndex,fieldIndex,updateRow,updateField,patchOp,pk,pkValue,updateKey,updateValue;var _this=this;return __generator(this,function(_b){switch(_b.label){case 0:this.cancelBlur=true;rowIndex=this.editingField[0],fieldIndex=this.editingField[1];updateRow=this.results[rowIndex];updateField=this.fieldNames[fieldIndex];patchOp=this.crud.find(function(x){return x.request.implements.some(function(i){return i.name=="IPatchDb`1";})&&x.request.properties.some(function(x){return x.name==updateField;});});pk=this.type.properties.find(function(x){return x.isPrimaryKey;});pkValue=pk&&client_1.getField(updateRow,pk.name);if(!updateField||!patchOp||!pk||!pkValue){this.responseStatus={errorCode:'InvalidState',message:"Results.saveEdit(): "+updateField+", "+patchOp+", "+pkValue};return[2];}
updateKey=this.findKey(rowIndex,updateField);updateValue=this.editingValue;shared_1.log('saveEdit',updateKey,updateField,this.editingValue,this.dirty,(_a=patchOp)===null||_a===void 0?void 0:_a.request.name);if(!this.dirty){this.cancelEdit();return[2];}
return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var args;return __generator(this,function(_a){switch(_a.label){case 0:args=[pk.name,pkValue];if(updateValue){args.push(updateField);args.push(updateValue);}
else{args.push('reset');args.push(updateField);}
return[4,shared_1.patchSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:patchOp.request.name,args:args}))];case 1:_a.sent();this.$set(updateRow,updateKey,updateValue);this.resetEdit();this.$emit('refresh');return[2];}});});})];case 1:_b.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:''})],Results.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop()],Results.prototype,"results",void 0);__decorate([vue_property_decorator_1.Prop()],Results.prototype,"eventIds",void 0);__decorate([vue_property_decorator_1.Prop()],Results.prototype,"type",void 0);__decorate([vue_property_decorator_1.Prop({default:[]})],Results.prototype,"crud",void 0);__decorate([vue_property_decorator_1.Watch('$route',{immediate:true,deep:true})],Results.prototype,"onUrlChange",null);Results=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"results.length\">\n    <table class=\"results\">\n        <thead><tr class=\"noselect\">\n            <th v-if=\"crud.length\">\n                <i v-if=\"!session\" class=\"svg svg-btn svg-auth svg-md\" title=\"Sign In to Edit\" @click=\"bus.$emit('signin')\" />\n                <i v-else-if=\"createOp\" class=\"svg svg-btn svg-create svg-md\" :title=\"createLabel\" @click=\"show('Create')\"/>\n            </th>\n            <th v-for=\"f in fieldNames\" :key=\"f\" :class=\"{partial:isPartialField(f)}\">\n                {{ humanize(f) }}\n            </th>\n            <th v-if=\"enableEvents\">\n                <i class=\"svg svg-history history-muted svg-md\" title=\"Event History\" />\n            </th>\n        </tr></thead>\n        <tbody>\n            <tr v-for=\"(r,i) in results\" :key=\"i\" :class=\"{ selected:selectedRow(i) }\">\n                <td v-if=\"crud.length\">\n                    <span v-if=\"hasCrud(['Update','Delete'])\">\n                        <i v-if=\"session && hasAccessibleCrud(['Update','Delete'])\" class=\"svg svg-btn svg-update svg-sm\" :title=\"updateLabel\" \n                           @click=\"editRow(i)\" />\n                        <i v-else class=\"svg svg-btn svg-auth auth-warning svg-md\" title=\"Sign In\" @click=\"bus.$emit('signin')\" />\n                    </span>\n                </td>\n                <td v-for=\"(f,j) in fieldNames\" :key=\"j\" :title=\"renderValue(getField(r,f))\" \n                    :class=\"{partial:isPartialField(f),editing:isEditingField(i,j), selected:selectedCell(i,j) }\" \n                    @click=\"selectField(i,j)\" @dblclick=\"isPartialField(f) && editField(i,j)\">                \n                    <span v-if=\"i==0 && j==0 && showCreate\">\n                        <create-modal v-if=\"createOp\" :slug=\"slug\" :op=\"createOp\" :type=\"type\" @done=\"handleDone('Create',$event)\" />\n                    </span>\n                    <div v-else-if=\"isEditingRow(i) && j == 0\">\n                        <edit-modal v-if=\"updateOp || deleteOp\" :slug=\"slug\" :updateOp=\"updateOp\" :deleteOp=\"deleteOp\" :type=\"type\" :row=\"r\" \n                                    @done=\"handleDone('Edit',$event)\" />\n                    </div>\n                    <div v-else-if=\"isEditingField(i,j)\">                        \n                        <input v-model=\"editingValue\" class=\"form-control form-control-sm\" \n                               @keydown.enter.stop=\"saveEdit()\" @keydown.esc.stop=\"cancelEdit()\" @blur=\"onEditBlur()\" />                \n                        <i v-if=\"dirty\" class=\"svg done-success svg-md svg-btn\" title=\"save\" @click=\"saveEdit()\" style=\"float:right;margin:-27px 5px 0 0;\"/>\n                    </div>\n                    <format v-else :value=\"getField(r,f)\" />\n                </td>\n                <td v-if=\"enableEvents\">\n                    <span v-if=\"selectedRow(i) && showEvents\">\n                        <events-modal :slug=\"slug\" :type=\"type\" :id=\"getId(r)\" @done=\"handleDone('Events')\" />                    \n                    </span>\n                    <i v-if=\"hasEvent(r)\" class=\"svg svg-history history-muted svg-btn svg-md\" title=\"Event History\" @click=\"show('Events',i)\" />\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <error-view :responseStatus=\"responseStatus\" />\n</div>\n<div v-else class=\"results-none\">\n    <div class=\"ml-1 mb-3\">\n        <span class=\"mr-1 d-inline-block\">There were no results</span>        \n        <button v-if=\"session && createOp\" class=\"btn btn-outline-primary btn-sm\" :title=\"createLabel\" @click=\"show('Create')\"\n            >&plus;\n            New {{type.name}}\n        </button>\n    </div>\n    <create-modal v-if=\"session && createOp && showCreate\" :slug=\"slug\" :op=\"createOp\" :type=\"type\" @done=\"handleDone('Create',$event)\" />\n</div>",})],Results);return Results;}(vue_1.default));exports.Results=Results;exports.default=Results;vue_1.default.component('results',Results);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var router_1=require("../../shared/router");var dtos_1=require("../../shared/dtos");var Home=(function(_super){__extends(Home,_super);function Home(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.txtBaseUrl='';_this.loading=false;_this.responseStatus=null;return _this;}
Object.defineProperty(Home.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});Home.prototype.routeAutoQuery=function(slug){return router_1.autoQueryRoute(slug);};Home.prototype.routeValidation=function(slug){return router_1.validationRoute(slug);};Home.prototype.hasPlugin=function(site,id){var _a;return((_a=site.plugins)===null||_a===void 0?void 0:_a.indexOf(id))>=0;};Home.prototype.deleteSite=function(site){var _this=this;if(confirm("Are you sure you want to remove '"+site.baseUrl+"' ?")){shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.delete(new dtos_1.ModifyConnection({removeSlug:site.slug}))];case 1:_a.sent();shared_1.bus.$emit('removeSite',site.slug);return[2];}});});});}};Home.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.client.get(new dtos_1.GetSites())];case 1:response=_a.sent();shared_1.bus.$emit('sites',response.sites);if(!this.$route.query.connect)return[3,3];this.txtBaseUrl=this.$route.query.connect;return[4,this.submit(true)];case 2:_a.sent();_a.label=3;case 3:return[2];}});});};Home.prototype.submit=function(autoLoad){if(autoLoad===void 0){autoLoad=false;}
return __awaiter(this,void 0,void 0,function(){var response,e_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,4,5,6]);this.loading=true;this.responseStatus=null;return[4,shared_1.client.post(new dtos_1.ModifyConnection({addBaseUrl:this.txtBaseUrl,}))];case 1:response=_a.sent();shared_1.bus.$emit('sites',response.sites);shared_1.bus.$emit('app',response);this.txtBaseUrl='';shared_1.log("/sites/"+response.slug);this.$router.push("/sites/"+response.slug);if(!autoLoad)return[3,3];return[4,shared_1.loadSite(response.slug)];case 2:_a.sent();_a.label=3;case 3:return[3,6];case 4:e_1=_a.sent();this.responseStatus=e_1.responseStatus||e_1;return[3,6];case 5:this.loading=false;return[7];case 6:return[2];}});});};__decorate([vue_property_decorator_1.Prop({default:''})],Home.prototype,"name",void 0);Home=__decorate([vue_property_decorator_1.Component({template:"<div id=\"content\" class=\"container mt-4\">\n        <div id=\"title\">\n            <h1>\n                <i class=\"svg-logo svg-4x\" />\n                ServiceStack Studio\n            </h1>\n        </div>\n        <div class=\"row justify-content-between\">\n            <div class=\"col mt-5 ml-4\">\n                <p class=\"lead\" style=\"font-size: 1.5em\">\n                    <i class=\"svg-connect svg-2x mr-1 mb-1\" />\n                    Connect to ServiceStack Instance:\n                </p>\n                \n                <form ref=\"form\" @submit.prevent=\"submit\" :class=\"{ error:responseStatus, loading }\" >\n                    <div class=\"form-group\">\n                        <error-summary except=\"baseUrl\" :responseStatus=\"responseStatus\" />\n                    </div>\n                    <div class=\"input-group\">\n                        <v-input id=\"baseUrl\" v-model=\"txtBaseUrl\" placeholder=\"BaseUrl\" :responseStatus=\"responseStatus\" \n                                 help=\"BaseUrl of remote ServiceStack App\" style=\"width: 24em\" />\n                        <button class=\"btn btn-social-icon btn-play btn-lg\">\n                          <i v-if=\"!loading\" class=\"fab fa-play\"></i>\n                          <i v-if=\"loading\" class=\"fab fa-loading\"></i>\n                        </button>\n                    </div>\n                </form>                \n            </div>\n        </div>\n        <div class=\"row mt-4 ml-3\">\n            <div class=\"col col-auto\">\n                <table class=\"site\">\n                    <tbody>\n                        <tr v-for=\"x in store.sites\" :key=\"x.baseUrl\">\n                            <td>\n                                <img v-if=\"x.iconUrl\" :src=\"x.iconUrl\" class=\"sq-lg mr-1 mb-1\">\n                                <i v-else class=\"svg-servicestack svg-lg mr-1 mb-1\" />\n                                {{ x.name }} <small>({{ x.baseUrl }})</small>\n                            </td>\n                            <td class=\"actions\">\n                                <button v-if=\"hasPlugin(x,'autoquery')\" @click=\"$router.push(routeAutoQuery(x.slug))\" class=\"btn btn-light\">\n                                    <i class=\"svg-db svg-md mb-1\" />\n                                    AutoQuery\n                                </button>\n                                <button v-if=\"hasPlugin(x,'validation')\" @click=\"$router.push(routeValidation(x.slug))\" class=\"btn btn-light\">\n                                    <i class=\"svg-lock svg-md mb-1\" />\n                                    Validation\n                                </button>\n                                <button class=\"btn btn-social-icon btn-sm mx-1\" @click=\"deleteSite(x)\">\n                                    <i class=\"fab fa-delete\"></i>\n                                </button>                                \n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>",components:{},})],Home);return Home;}(vue_property_decorator_1.Vue));exports.Home=Home;exports.default=Home;;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../../shared");var dtos_1=require("../../shared/dtos");var client_1=require("@servicestack/client");var EditValidationRule=(function(_super){__extends(EditValidationRule,_super);function EditValidationRule(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.field=null;_this.validator='';_this.condition='';_this.errorCode='';_this.message='';_this.notes='';_this.typeTab='validator';_this.allowDelete=false;_this.loading=false;_this.responseStatus=null;_this.typesWrapper={'String[]':function(p){return"['"+p+"']";},'String':function(p){return"'"+p+"'";},};return _this;}
Object.defineProperty(EditValidationRule.prototype,"isTypeValidator",{get:function(){return!this.properties;},enumerable:true,configurable:true});Object.defineProperty(EditValidationRule.prototype,"placeholderValidator",{get:function(){return(this.isTypeValidator?'Type':'Property')+' Validator';},enumerable:true,configurable:true});Object.defineProperty(EditValidationRule.prototype,"conditionValidator",{get:function(){return'Condition e.g: '+(this.isTypeValidator?'dto.Prop1 != dto.Prop2':'it.isOdd()');},enumerable:true,configurable:true});EditValidationRule.prototype.id=function(id){return this.ruleType+"-"+id;};Object.defineProperty(EditValidationRule.prototype,"ruleType",{get:function(){return(this.isTypeValidator?'type':'prop');},enumerable:true,configurable:true});EditValidationRule.prototype.mounted=function(){var _a;if(this.condition){this.typeTab='condition';}
this.field=this.properties&&((_a=this.properties[0])===null||_a===void 0?void 0:_a.name)||null;if(!this.rule)
return;this.field=this.rule.field;this.validator=this.rule.validator;this.condition=this.rule.condition;this.errorCode=this.rule.errorCode;this.message=this.rule.message;this.notes=this.rule.notes;};EditValidationRule.prototype.setTypeTab=function(tab){this.typeTab=tab;};EditValidationRule.prototype.activeTypeTab=function(tab){return this.typeTab==tab;};EditValidationRule.prototype.focusValidator=function(sel){var _a,_b,_c,_d;var txt=document.querySelector(sel);var hasQuotes=true;var startPos=(_a=txt)===null||_a===void 0?void 0:_a.value.indexOf("'"),endPos=(_b=txt)===null||_b===void 0?void 0:_b.value.indexOf("'",startPos+1);if(!(startPos>=0&&endPos>=0)){hasQuotes=false;startPos=(_c=txt)===null||_c===void 0?void 0:_c.value.indexOf("{");endPos=(_d=txt)===null||_d===void 0?void 0:_d.value.indexOf("}",startPos);}
if(txt&&startPos>=0&&endPos>=0){txt.selectionStart=hasQuotes?startPos+1:startPos;txt.selectionEnd=hasQuotes?endPos:endPos+1;txt.focus();}};EditValidationRule.prototype.editValidator=function(v){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){this.validator=this.editfmt(v);return[2,this.$nextTick(function(){return _this.focusValidator('#'+_this.id('validator'));})];});});};EditValidationRule.prototype.wrap=function(type,p){var f=this.typesWrapper[type];return f&&f(p)||'{'+p+'}';};EditValidationRule.prototype.editfmt=function(v){var _this=this;var _a;return v.name+(((_a=v.paramNames)===null||_a===void 0?void 0:_a.length)>0?"("+v.paramNames.map(function(p,i){return _this.wrap(v.paramTypes[i],p);}).join(',')+")":'');};EditValidationRule.prototype.fmt=function(v){var _a;return v.name+(((_a=v.paramNames)===null||_a===void 0?void 0:_a.length)>0?"("+v.paramNames.join(',')+")":'');};EditValidationRule.prototype.submitDelete=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('submitDelete');return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var request;return __generator(this,function(_a){switch(_a.label){case 0:request=new dtos_1.ModifyValidationRules({deleteRuleIds:[this.rule.id]});return[4,shared_1.deleteSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:client_1.nameOf(request),args:shared_1.dtoAsArgs(request)}))];case 1:_a.sent();this.$emit('done',this.rule);return[2];}});});})];case 1:_a.sent();return[2];}});});};EditValidationRule.prototype.submit=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var request;return __generator(this,function(_a){switch(_a.label){case 0:request=new dtos_1.ValidationRule({type:this.type.name,});if(this.validator){request.validator=this.validator;}
else if(this.condition){request.condition=this.condition;}
if(this.field)
request.field=this.field;if(this.errorCode)
request.errorCode=this.errorCode;if(this.message)
request.message=this.message;if(this.notes)
request.notes=this.notes;if(this.rule)
request.id=this.rule.id;return[4,shared_1.postSiteProxy(new dtos_1.SiteProxy({slug:this.slug,request:client_1.nameOf(new dtos_1.ModifyValidationRules)}),new dtos_1.ModifyValidationRules({saveRules:[request]}))];case 1:_a.sent();this.$emit('done',request);return[2];}});});})];case 1:_a.sent();return[2];}});});};__decorate([vue_property_decorator_1.Prop()],EditValidationRule.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop()],EditValidationRule.prototype,"validators",void 0);__decorate([vue_property_decorator_1.Prop()],EditValidationRule.prototype,"type",void 0);__decorate([vue_property_decorator_1.Prop()],EditValidationRule.prototype,"properties",void 0);__decorate([vue_property_decorator_1.Prop()],EditValidationRule.prototype,"rule",void 0);EditValidationRule=__decorate([vue_property_decorator_1.Component({template:"\n<form @submit.prevent.stop=\"submit()\" class=\"create-property-rule m-2\">\n    <i class=\"text-close float-right\" title=\"close\" @click=\"$emit('done',{field:field})\" />\n    <error-summary except=\"validator,condition,errorCode,message,notes\" :responseStatus=\"responseStatus\" />\n    \n     <ul class=\"nav nav-pills mb-1\" role=\"tablist\">\n        <li class=\"nav-item\" @click=\"setTypeTab('validator')\">\n            <span :class=\"['nav-link', {active:activeTypeTab('validator')}]\">Validator</span>\n        </li>\n        <li class=\"nav-item\" @click=\"setTypeTab('condition')\">\n            <span :class=\"['nav-link', {active:activeTypeTab('condition')}]\">Script</span>\n        </li>\n    </ul>\n    <div class=\"tab-content\" :class=\"[isTypeValidator ? 'type-rule' : null]\">\n        <div :class=\"['tab-pane', {active:activeTypeTab('validator')}]\" role=\"tabpanel\">\n            <v-input :id=\"id('validator')\" statusField=\"Validator\" v-model=\"validator\" :responseStatus=\"responseStatus\" \n                     :placeholder=\"placeholderValidator\" spellcheck=\"false\"\n                     help=\"Choose from any of the pre-defined validator's below\" /> \n        </div>\n        <div :class=\"['tab-pane', {active:activeTypeTab('condition')}]\" role=\"tabpanel\">\n            <v-input statusField=\"condition\" v-model=\"condition\" :responseStatus=\"responseStatus\" \n                     :placeholder=\"conditionValidator\" spellcheck=\"false\" \n                     help=\"Script Expression that must evaluate to true, see: sharpscript.net\" />\n        </div>\n    </div>\n\n    <v-select v-if=\"properties\" class=\"mt-2\" statusField=\"field\" v-model=\"field\" :responseStatus=\"responseStatus\" \n             help=\"The property this rule applies to\" :values=\"properties.map(x => x.name)\">\n    </v-select>\n\n    <v-input statusField=\"errorCode\" v-model=\"errorCode\" inputClass=\"form-control-md mt-3\" :responseStatus=\"responseStatus\" \n             placeholder=\"ErrorCode\" help=\"Override with custom error code?\" /> \n    <v-input statusField=\"message\" v-model=\"message\" inputClass=\"form-control-md mt-1\" :responseStatus=\"responseStatus\" \n             placeholder=\"Error Message\" help=\"Override with custom message?\" /> \n    <v-input statusField=\"notes\" v-model=\"notes\" inputClass=\"form-control-md mt-1\" :responseStatus=\"responseStatus\" \n             placeholder=\"Notes\" help=\"Attach a note to this rule?\" /> \n\n    <div class=\"text-right mt-3\">\n        <span class=\"btn btn-link\" @click=\"$emit('done',{field:field})\">close</span>\n        <button type=\"submit\" class=\"btn btn-primary\">&plus;\n            <span v-if=\"rule\">Update Rule</span>\n            <span v-else>Create Rule</span>\n        </button>\n    </div>\n    <div v-if=\"rule\" class=\"confirm-delete\" style=\"margin:-38px 0 0 20px;line-height: 30px;\">\n        <input type=\"checkbox\" class=\"form-check-input\" @change=\"allowDelete=!allowDelete\" :id=\"id('confirm')\"/>\n        <label :for=\"id('confirm')\" class=\"form-check-label\" >confirm</label>\n        <button class=\"btn btn-danger\" @click.prevent=\"submitDelete()\" :disabled=\"!allowDelete\">delete</button>\n    </div>\n    \n    <h4 class=\"my-3\">Quick Select {{isTypeValidator ? 'Type' : 'Property'}} Validator</h4>\n\n    <div v-for=\"x in validators\" :key=\"x.name + x.paramNames\">\n        <span class=\"btn btn-sm btn-outline-secondary mt-1\" @click=\"editValidator(x)\">{{fmt(x)}}</span>\n    </div>\n</form>\n"})],EditValidationRule);return EditValidationRule;}(vue_property_decorator_1.Vue));exports.EditValidationRule=EditValidationRule;vue_property_decorator_1.Vue.component('edit-validation-rule',EditValidationRule);var Validation=(function(_super){__extends(Validation,_super);function Validation(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.txtFilter='';_this.showTypeForm=false;_this.editTypeRule=null;_this.showPropertyForm=false;_this.editPropertyRule=null;_this.results=[];_this.loading=false;_this.responseStatus=null;return _this;}
Validation.prototype.viewTypeForm=function(ruleId){if(ruleId===void 0){ruleId=null;}
this.showTypeForm=true;this.editTypeRule=ruleId;};Validation.prototype.viewPropertyForm=function(ruleId){if(ruleId===void 0){ruleId=null;}
this.showPropertyForm=true;this.editPropertyRule=ruleId;};Validation.prototype.onUrlChange=function(newVal){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.reset()];case 1:_a.sent();return[2];}});});};Validation.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('Validation.reset()',this.op);this.responseStatus=null;this.showTypeForm=this.showPropertyForm=false;this.editTypeRule=this.editPropertyRule=null;return[4,shared_1.exec(this,function(){return __awaiter(_this,void 0,void 0,function(){var responseJson,response;return __generator(this,function(_a){switch(_a.label){case 0:if(!this.operation)
return[2];return[4,shared_1.getSiteInvoke(new dtos_1.SiteInvoke({slug:this.slug,request:client_1.nameOf(new dtos_1.GetValidationRules),args:shared_1.dtoAsArgs(new dtos_1.GetValidationRules({type:this.op}))}))];case 1:responseJson=_a.sent();response=JSON.parse(responseJson);this.results=response.results;return[2];}});});})];case 1:_a.sent();return[2];}});});};Object.defineProperty(Validation.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"bus",{get:function(){return shared_1.bus;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"slug",{get:function(){return this.$route.params.slug;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"op",{get:function(){return this.$route.query.op;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"operation",{get:function(){var _this=this;return this.api.operations.find(function(x){return x.request.name==_this.op;});},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"hasProperties",{get:function(){var _a,_b,_c;return _c=(_b=(_a=this.operation)===null||_a===void 0?void 0:_a.request.properties)===null||_b===void 0?void 0:_b.length,(_c!==null&&_c!==void 0?_c:0>0);},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"site",{get:function(){return shared_1.store.getSite(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"app",{get:function(){return shared_1.store.getApp(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"api",{get:function(){var _a;return(_a=this.app)===null||_a===void 0?void 0:_a.api;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"plugin",{get:function(){var _a;return(_a=shared_1.store.getApp(this.slug))===null||_a===void 0?void 0:_a.plugins.validation;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"enabled",{get:function(){return this.app&&shared_1.store.hasPlugin(this.slug,'validation');},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"accessible",{get:function(){return this.enabled&&shared_1.store.hasRole(this.slug,this.plugin.accessRole);},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"session",{get:function(){return shared_1.store.getSession(this.slug);},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"windowStyles",{get:function(){return!this.accessible||shared_1.collapsed(this.slug,'footer')?'collapse-footer':'';},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"autoQueryOp",{get:function(){var _a,_b;var dataModel=(_a=this.operation)===null||_a===void 0?void 0:_a.dataModel;if(!dataModel)
return null;var op=this.api.operations.find(function(x){return shared_1.matchesType(x.dataModel,dataModel)&&shared_1.isQuery(x);});return(_b=op)===null||_b===void 0?void 0:_b.request.name;},enumerable:true,configurable:true});Object.defineProperty(Validation.prototype,"dataModelOps",{get:function(){var _a;var dataModel=(_a=this.operation)===null||_a===void 0?void 0:_a.dataModel;if(!dataModel)
return[];return this.api.operations.filter(function(x){return shared_1.matchesType(x.dataModel,dataModel);});},enumerable:true,configurable:true});Validation.prototype.mounted=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,shared_1.loadSite(this.slug)];case 1:_a.sent();return[4,this.reset()];case 2:_a.sent();shared_1.bus.$on('signedin',function(){_this.reset();});return[2];}});});};Validation.prototype.matchesType=function(x,y){return shared_1.matchesType(x,y);};Validation.prototype.typeKey=function(type){return(type.namespace||'')+'.'+type.name;};Object.defineProperty(Validation.prototype,"operations",{get:function(){if(!this.app)
return[];var search=this.txtFilter.toLowerCase();return this.api.operations.filter(function(op){return op.request.name.toLowerCase().indexOf(search)>=0;});},enumerable:true,configurable:true});Validation.prototype.handleDone=function(rule){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:shared_1.log('handleDone',rule);if(rule.field){this.showPropertyForm=false;this.editPropertyRule=null;}
else{this.showTypeForm=false;this.editTypeRule=null;}
if(!(rule.validator||rule.condition))return[3,2];return[4,this.reset()];case 1:_a.sent();_a.label=2;case 2:return[2];}});});};__decorate([vue_property_decorator_1.Watch('$route',{immediate:true,deep:true})],Validation.prototype,"onUrlChange",null);Validation=__decorate([vue_property_decorator_1.Component({template:"<section v-if=\"enabled\" id=\"validation\" :class=\"['grid-layout',windowStyles]\">\n\n        <header id=\"header\">\n            <h1 v-if=\"site\">\n                <nav class=\"site-breadcrumbs\">\n                    <ol class=\"breadcrumb\">\n                        <li class=\"breadcrumb-item\">\n                            <router-link to=\"/\"><i class=\"svg-home svg-3x mb-1\" title=\"home\" /></router-link>\n                        </li>\n                        <li :class=\"['breadcrumb-item',{active:!operation}]\">\n                            <img v-if=\"site.iconUrl\" :src=\"site.iconUrl\" class=\"sq-3x mb-1\">\n                            <i v-else class=\"svg lock-dark svg-3x mb-1\" \n                               /><router-link v-if=\"operation\" to=\"?\">{{site.name}}</router-link>                \n                            <span v-else>{{site.name}}</span>\n                        </li>\n                        <li v-if=\"operation\" class=\"breadcrumb-item active\">{{operation.request.name}}</li>\n                        <li v-if=\"loading\"><i class=\"svg-loading svg-lg ml-2 mb-1\" title=\"loading...\" /></li>\n                    </ol>\n                </nav>\n            </h1>\n            <h1 v-else-if=\"loading\">\n              <i class=\"fab fa-loading\"></i>\n              Loading...\n            </h1>\n            <div v-else-if=\"responseStatus\">\n                <error-summary :responseStatus=\"responseStatus\" />\n                <router-link to=\"/\">&lt; back to sites</router-link>\n            </div>\n            <auth id=\"auth\" v-if=\"site && app\" :slug=\"slug\" feature=\"validation\" :op=\"autoQueryOp\" /> \n        </header>\n        \n        <nav id=\"left\">\n            <div id=\"nav-filter\">\n                <i v-if=\"txtFilter\" class=\"text-close\" style=\"position:absolute;margin:0 0 0 265px;\" title=\"clear\" @click=\"txtFilter=''\"></i>\n                <v-input v-model=\"txtFilter\" id=\"txtFilter\" placeholder=\"filter\" inputClass=\"form-control\" />\n            </div>\n            <div id=\"sidebar\" class=\"\">\n                <div class=\"pl-2\">\n                    <div v-for=\"x in operations\" :key=\"typeKey(x.request)\" \n                        :class=\"['datamodel',{selected:x.request.name==op}]\" :title=\"x.request.name\">\n                        <router-link :to=\"{ query: { op:x.request.name } }\">{{x.request.name}}</router-link>\n                    </div>\n                </div>\n            </div>\n        </nav>\n        \n        <main>\n            <div v-if=\"operation && !loading\">\n                <div v-if=\"accessible\" class=\"main-container\">\n                    <table id=\"validation-rules\" class=\"ml-2\">\n                    <thead>\n                        <tr>\n                            <th>\n                                <i class=\"svg svg-lock svg-lg\"/> Type Validation Rules\n                            </th>\n                            <th>\n                                <div v-if=\"hasProperties\">\n                                    <i class=\"svg svg-lock svg-lg\"/> Property Validation Rules\n                                </div>\n                            </th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                    <tr>\n                        <td class=\"pr-3\">\n                            <div v-for=\"x in results.filter(x => x.field == null)\" :key=\"x.id\" class=\"rule\">\n                                <edit-validation-rule v-if=\"editTypeRule==x.id\" :slug=\"slug\" :type=\"operation.request\" :rule=\"x\" \n                                                      :validators=\"plugin.typeValidators\" @done=\"handleDone($event)\" />\n                                <div v-else>\n                                    <button class=\"btn btn-light btn-sm edit-rule\" @click=\"viewTypeForm(x.id)\"\n                                            title=\"Edit Rule\"><i class=\"svg-update svg-md\"/></button>\n                                    <dl class=\"h-kvp\">\n                                        <dt>{{x.validator ? 'validator':'script'}}</dt>\n                                        <dd><b class=\"field\">{{x.field}}</b>{{x.validator ?? x.condition}}</dd>\n                                    </dl>\n                                </div>\n                            </div>\n                        \n                            <button v-if=\"!showTypeForm\" class=\"btn btn-outline-primary btn-lg\" @click=\"viewTypeForm()\">&plus;\n                                Add Type Validation Rule \n                            </button>\n                            <edit-validation-rule v-else-if=\"editTypeRule==null\" :slug=\"slug\" :type=\"operation.request\" \n                                                  :validators=\"plugin.typeValidators\" @done=\"handleDone($event)\" />\n                        </td>\n                        <td>\n                            <div v-for=\"x in results.filter(x => x.field != null)\" :key=\"x.id\" class=\"h-kvp rule\">\n                                <edit-validation-rule v-if=\"editPropertyRule==x.id\" :slug=\"slug\" :type=\"operation.request\" :rule=\"x\" \n                                                      :validators=\"plugin.propertyValidators\" :properties=\"operation.request.properties\" \n                                                      @done=\"handleDone($event)\" />\n                                <div v-else>\n                                    <button class=\"btn btn-light btn-sm edit-rule\" @click=\"viewPropertyForm(x.id)\"\n                                            title=\"Edit Rule\"><i class=\"svg-update svg-md\"/></button>\n                                    <dl class=\"h-kvp\">\n                                        <dt>{{x.field}} {{x.validator ? 'validator':'script'}}</dt>\n                                        <dd>{{x.validator ?? x.condition}}</dd>\n                                    </dl>\n                                </div>\n                            </div>\n                        \n                            <button v-if=\"!showPropertyForm\" class=\"btn btn-outline-primary btn-lg\" @click=\"viewPropertyForm()\">&plus;\n                                Add Property Validation Rule \n                            </button>\n                            <edit-validation-rule v-else-if=\"editPropertyRule==null\" :slug=\"slug\" :type=\"operation.request\" \n                                                  :validators=\"plugin.propertyValidators\" @done=\"handleDone($event)\" \n                                                  :properties=\"operation.request.properties\" />\n                        </td>\n                    </tr>\n                    </tbody>\n                    </table>\n                    \n                    <div v-if=\"dataModelOps.length\" class=\"datamodel-nav mt-5\">\n                        <b class=\"float-left\" style=\"line-height: 40px\">Quick Jump:</b>\n                        <ul class=\"nav\">\n                            <li v-for=\"x in dataModelOps\" class=\"nav-item\">\n                                <router-link :class=\"['nav-link',{active:x.request.name==op}]\" \n                                    :to=\"{ query: { op:x.request.name } }\">{{x.request.name}}</router-link>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n                <div v-else-if=\"!session\" class=\"text-center\" style=\"position:absolute;left:50%;margin:50px 0 0 -100px\">\n                    <i class=\"svg svg-lock svg-10x mb-1\" />\n                    <h3 class=\"mb-3\">Validation</h3>\n                    <button v-if=\"!loading\" @click=\"bus.$emit('signin')\" class=\"btn btn-outline-primary\">\n                        Sign In\n                    </button>\n                </div>\n                <div v-else>\n                    Only {{plugin.accessRole}} Users can maintain Validation Rules\n                </div>\n            </div>\n        </main>\n        \n        <Footer v-if=\"app\" :slug=\"slug\"/>\n        \n    </section>\n    <no-plugin v-else :slug=\"slug\" plugin=\"validation\" />",})],Validation);return Validation;}(vue_property_decorator_1.Vue));exports.Validation=Validation;exports.default=Validation;vue_property_decorator_1.Vue.component('validation',Validation);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var About=(function(_super){__extends(About,_super);function About(){return _super!==null&&_super.apply(this,arguments)||this;}
__decorate([vue_property_decorator_1.Prop({default:null})],About.prototype,"message",void 0);About=__decorate([vue_property_decorator_1.Component({template:"<div id=\"about\">\n        <div class=\"svg-users svg-8x ml-2\"/>\n        <h3>{{message}}</h3>\n    </div>"})],About);return About;}(vue_property_decorator_1.Vue));exports.About=About;exports.default=About;;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var ErrorView=(function(_super){__extends(ErrorView,_super);function ErrorView(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.showStackTrace=false;return _this;}
__decorate([vue_property_decorator_1.Prop({default:null})],ErrorView.prototype,"responseStatus",void 0);ErrorView=__decorate([vue_property_decorator_1.Component({template:"<div v-if=\"responseStatus\" class=\"noplugin-error alert alert-danger mt-3 mr-3\">\n    <div>{{responseStatus.errorCode}}: {{responseStatus.message}}</div>\n    <div v-if=\"responseStatus.stackTrace\">\n        <button v-if=\"!showStackTrace\" class=\"btn btn-link\" style=\"margin-left: -1em\" @click=\"showStackTrace=true\">\n            <i class=\"svg-chevron-right svg-lg mb-1\" title=\"expand\" />StackTrace</button>\n        <div v-if=\"showStackTrace\" class=\"stacktrace\">{{responseStatus.stackTrace}}</div>\n    </div>\n</div>"})],ErrorView);return ErrorView;}(vue_property_decorator_1.Vue));exports.ErrorView=ErrorView;exports.default=ErrorView;vue_property_decorator_1.Vue.component('error-view',ErrorView);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __spreadArrays=(this&&this.__spreadArrays)||function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)
for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)
r[k]=a[j];return r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../shared");var client_1=require("@servicestack/client");var Footer=(function(_super){__extends(Footer,_super);function Footer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.showResponseIds=[];return _this;}
Object.defineProperty(Footer.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});Object.defineProperty(Footer.prototype,"views",{get:function(){return this.store.getAppPrefs(this.slug).views||[];},set:function(val){vue_property_decorator_1.Vue.set(this.store.getAppPrefs(this.slug),'views',val);},enumerable:true,configurable:true});Footer.prototype.collapsed=function(view){return shared_1.collapsed(this.slug,view);};Footer.prototype.kvps=function(args){return shared_1.argsAsKvps(args);};Footer.prototype.showView=function(view){this.views=__spreadArrays(this.views,[view]);};Footer.prototype.hideView=function(view){this.views=this.views.filter(function(x){return x!=view;});};Footer.prototype.responseVisible=function(id){return this.showResponseIds.indexOf(id)>=0;};Footer.prototype.toggleResponse=function(id){if(this.responseVisible(id)){this.showResponseIds=this.showResponseIds.filter(function(x){return x!=id;});}
else{this.showResponseIds.push(id);}};Object.defineProperty(Footer.prototype,"logEntries",{get:function(){return this.store.appLogEntries[this.slug]||[];},enumerable:true,configurable:true});Object.defineProperty(Footer.prototype,"baseUrl",{get:function(){return shared_1.store.getSite(this.slug).baseUrl;},enumerable:true,configurable:true});Footer.prototype.createUrl=function(invoke){var _a,_b,_c,_d;if(!invoke)
return;var op=(_a=shared_1.store.getApp(this.slug).api.operations)===null||_a===void 0?void 0:_a.find(function(x){return x.request.name==invoke.request;});var defaultRoute=(_b=op)===null||_b===void 0?void 0:_b.routes.find(function(x){return x.path.indexOf('{')==-1;});var url=defaultRoute?client_1.combinePaths(this.baseUrl,defaultRoute.path):client_1.combinePaths(this.baseUrl,'json','reply',invoke.request);for(var i=0;_d=i<((_c=invoke.args)===null||_c===void 0?void 0:_c.length),(_d!==null&&_d!==void 0?_d:0);i+=2){url+=i==0?'?':'&';url+=invoke.args[i]+'='+encodeURIComponent(invoke.args[i+1]);}
return url;};__decorate([vue_property_decorator_1.Prop()],Footer.prototype,"slug",void 0);Footer=__decorate([vue_property_decorator_1.Component({template:"<footer id=\"footer\" v-if=\"!collapsed('footer')\">\n        <i class=\"text-close\" title=\"close\" @click=\"hideView('footer')\"/>\n        <div id=\"panels\">\n            <div v-for=\"x in logEntries\" class=\"log-entry\">\n                <div v-if=\"x.invoke\" class=\"invoke\">\n                    <h4><i>{{x.method}}</i><b>{{x.invoke.request}}</b>\n                        <a v-if=\"x.method == 'GET'\" :href=\"createUrl(x.invoke)\" :title=\"createUrl(x.invoke)\" \n                           class=\"svg-external-link svg-md mb-1\" target=\"_blank\"></a> \n                    </h4>\n                    <div v-if=\"x.invoke.args.length\" class=\"body\">\n                        <dl v-for=\"x in kvps(x.invoke.args)\" class=\"v-kvp\">\n                            <dt>{{x.key}}</dt>\n                            <dd v-if=\"x.value!=''\" :title=\"x.value\">{{x.value}}</dd>\n                        </dl>\n                        <dl v-if=\"x.response\" class=\"v-kvp log-response\">\n                            <dt v-if=\"responseVisible(x.id)\" @click=\"toggleResponse(x.id)\"><i class=\"svg svg-chevron-down svg-sm\"/>response</dt>\n                            <dt v-else @click=\"toggleResponse(x.id)\"><i class=\"svg svg-chevron-right svg-sm\"/>response</dt>\n                            <dd v-if=\"responseVisible(x.id)\"><jsonviewer :json=\"x.response\"/></dd>\n                        </dl>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </footer>\n    <div v-else id=\"output-group\">\n        <button class=\"btn btn-outline-secondary btn-sm\" @click=\"showView('footer')\">output</button>        \n    </div>"})],Footer);return Footer;}(vue_property_decorator_1.Vue));exports.Footer=Footer;vue_property_decorator_1.Vue.component('Footer',Footer);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var client_1=require("@servicestack/client");var show=function(k){return typeof k!=="string"||k.substr(0,2)!=="__";};var keyFmt=function(t){return client_1.humanize(client_1.toPascalCase(t));};var uniqueKeys=function(m){var h={};for(var i=0,len=m.length;i<len;i++){var values=m[i];for(var k in values){if(values.hasOwnProperty(k)&&show(k)){h[k]=k;}}}
return h;};var valueFmt=function(k,v,vFmt){return vFmt;};var num=function(m){return m;};var date=function(s){return client_1.toDate(s);};var pad=function(d){return d<10?'0'+d:d;};var dmft=function(d){return d.getFullYear()+'/'+pad(d.getMonth()+1)+'/'+pad(d.getDate());};var str=function(m){return m.substr(0,6)==='/Date('?dmft(date(m)):m;};var obj=function(m){return("<dl>\n            "+Object.keys(m).filter(show).map(function(k){return("<dt class=\"ib\">"+keyFmt(k)+"</dt><dd>"+valueFmt(k,m[k],val(m[k]))+"</dd>");}).join('')+"\n        </dl>");};var arr=function(m){if(typeof m[0]=='string'||typeof m[0]=='number')
return"<span>"+m.join(', ')+"</span>";var h=uniqueKeys(m);return("\n        <table>\n            <caption></caption>\n        <thead>\n            <tr>\n                "+Object.keys(h).map(function(k){return("<th><b></b>"+keyFmt(k)+"</th>");}).join('')+"\n            </tr>\n        </thead>\n        <tbody>\n        "+m.map(function(row){return("<tr>\n                "+Object.keys(h).filter(show).map(function(k){return"<td>"+valueFmt(k,row[k],val(row[k]))+"</td>";}).join('')+"\n            </tr>");}).join('')+"\n        </tbody>\n    </table>");};var val=function(m,valueFn){if(valueFn)
valueFmt=valueFn;if(m==null)
return"";if(typeof m=="number")
return""+num(m);if(typeof m=="string")
return str(m);if(typeof m=="boolean")
return m?"true":"false";return m.length?arr(m):obj(m);};var JsonViewer=(function(_super){__extends(JsonViewer,_super);function JsonViewer(){return _super!==null&&_super.apply(this,arguments)||this;}
Object.defineProperty(JsonViewer.prototype,"html",{get:function(){return this.json?val(JSON.parse(this.json)):val(this.value);},enumerable:true,configurable:true});__decorate([vue_property_decorator_1.Prop({default:null})],JsonViewer.prototype,"value",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],JsonViewer.prototype,"json",void 0);JsonViewer=__decorate([vue_property_decorator_1.Component({template:"<div class=\"jsonviewer\">\n        <div v-html=\"html\"></div>\n        <span class=\"clearfix\"></span>\n    </div>"})],JsonViewer);return JsonViewer;}(vue_property_decorator_1.Vue));exports.JsonViewer=JsonViewer;exports.default=JsonViewer;vue_property_decorator_1.Vue.component('jsonviewer',JsonViewer);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("../shared");var messages={auth:'Auth',autoquery:'AutoQuery',};exports.siteError=function(slug,plugin){var error=shared_1.store.appErrors[slug];if(error){return error.errorCode+": "+error.message;}
return'';};var NoPlugin=(function(_super){__extends(NoPlugin,_super);function NoPlugin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.showStackTrace=false;return _this;}
Object.defineProperty(NoPlugin.prototype,"siteError",{get:function(){return shared_1.store.appErrors[this.slug];},enumerable:true,configurable:true});Object.defineProperty(NoPlugin.prototype,"loading",{get:function(){return shared_1.store.appLoading[this.slug];},enumerable:true,configurable:true});Object.defineProperty(NoPlugin.prototype,"errorMessage",{get:function(){return this.message||(messages[this.plugin]||'This plugin')+' is not enabled for this site';},enumerable:true,configurable:true});NoPlugin.prototype.mounted=function(){shared_1.log('NoPlugin mounted()');};NoPlugin.errorHtml=function(slug,plugin){var loading=shared_1.store.appLoading[slug];if(loading){return("<div class=\"noplugin-loading m-3\">\n                    <i class=\"svg-loading svg-lg mr-1 mb-1\"></i> loading...\n                </div>");}
var error=shared_1.store.appErrors[slug];if(error){return('<div class="noplugin-error alert alert-danger m-3">'+error.errorCode+": "+error.message+
(error.stackTrace?'<div class="stacktrace">'+error.stackTrace+'</div>':'')+'</div>');}
return'<div class="noplugin-error alert alert-danger m-3">'+(messages[plugin]||'This plugin')+' is not enabled for this site'+'</div>';};__decorate([vue_property_decorator_1.Prop()],NoPlugin.prototype,"slug",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],NoPlugin.prototype,"plugin",void 0);__decorate([vue_property_decorator_1.Prop({default:null})],NoPlugin.prototype,"message",void 0);NoPlugin=__decorate([vue_property_decorator_1.Component({template:"<div>\n        <div v-if=\"loading\" class=\"noplugin-loading m-3\">\n            <i class=\"svg-loading svg-lg mr-1 mb-1\" /> loading...\n        </div>\n        <div v-else>\n             <div v-if=\"siteError\" class=\"noplugin-error alert alert-danger m-3\">\n                <div>{{siteError.errorCode}}: {{siteError.message}}</div>\n                <div v-if=\"siteError.stackTrace\">\n                    <button v-if=\"!showStackTrace\" class=\"btn btn-link\" style=\"margin-left: -1em\" @click=\"showStackTrace=true\">\n                        <i class=\"svg-chevron-right svg-lg mb-1\" title=\"expand\" />StackTrace</button>\n                    <div v-if=\"showStackTrace\" class=\"stacktrace\">{{siteError.stackTrace}}</div>\n                </div>\n            </div>\n             <div v-else class=\"noplugin-error alert alert-danger m-3\">\n                {{errorMessage}}\n            </div>\n            <a href=\"/\" class=\"ml-4\">&lt; home</a>\n        </div>\n    </div>"})],NoPlugin);return NoPlugin;}(vue_property_decorator_1.Vue));exports.NoPlugin=NoPlugin;exports.default=NoPlugin;vue_property_decorator_1.Vue.component('no-plugin',NoPlugin);;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();Object.defineProperty(exports,"__esModule",{value:true});var AppPrefs=(function(){function AppPrefs(init){Object.assign(this,init);}
return AppPrefs;}());exports.AppPrefs=AppPrefs;var SiteSetting=(function(){function SiteSetting(init){Object.assign(this,init);}
return SiteSetting;}());exports.SiteSetting=SiteSetting;var ResponseError=(function(){function ResponseError(init){Object.assign(this,init);}
return ResponseError;}());exports.ResponseError=ResponseError;var ResponseStatus=(function(){function ResponseStatus(init){Object.assign(this,init);}
return ResponseStatus;}());exports.ResponseStatus=ResponseStatus;var AppInfo=(function(){function AppInfo(init){Object.assign(this,init);}
return AppInfo;}());exports.AppInfo=AppInfo;var NavItem=(function(){function NavItem(init){Object.assign(this,init);}
return NavItem;}());exports.NavItem=NavItem;var MetaAuthProvider=(function(){function MetaAuthProvider(init){Object.assign(this,init);}
return MetaAuthProvider;}());exports.MetaAuthProvider=MetaAuthProvider;var AuthInfo=(function(){function AuthInfo(init){Object.assign(this,init);}
return AuthInfo;}());exports.AuthInfo=AuthInfo;var AutoQueryConvention=(function(){function AutoQueryConvention(init){Object.assign(this,init);}
return AutoQueryConvention;}());exports.AutoQueryConvention=AutoQueryConvention;var AutoQueryInfo=(function(){function AutoQueryInfo(init){Object.assign(this,init);}
return AutoQueryInfo;}());exports.AutoQueryInfo=AutoQueryInfo;var ScriptMethodType=(function(){function ScriptMethodType(init){Object.assign(this,init);}
return ScriptMethodType;}());exports.ScriptMethodType=ScriptMethodType;var ValidationInfo=(function(){function ValidationInfo(init){Object.assign(this,init);}
return ValidationInfo;}());exports.ValidationInfo=ValidationInfo;var SharpPagesInfo=(function(){function SharpPagesInfo(init){Object.assign(this,init);}
return SharpPagesInfo;}());exports.SharpPagesInfo=SharpPagesInfo;var RequestLogsInfo=(function(){function RequestLogsInfo(init){Object.assign(this,init);}
return RequestLogsInfo;}());exports.RequestLogsInfo=RequestLogsInfo;var PluginInfo=(function(){function PluginInfo(init){Object.assign(this,init);}
return PluginInfo;}());exports.PluginInfo=PluginInfo;var MetadataTypesConfig=(function(){function MetadataTypesConfig(init){Object.assign(this,init);}
return MetadataTypesConfig;}());exports.MetadataTypesConfig=MetadataTypesConfig;var MetadataTypeName=(function(){function MetadataTypeName(init){Object.assign(this,init);}
return MetadataTypeName;}());exports.MetadataTypeName=MetadataTypeName;var MetadataDataContract=(function(){function MetadataDataContract(init){Object.assign(this,init);}
return MetadataDataContract;}());exports.MetadataDataContract=MetadataDataContract;var MetadataDataMember=(function(){function MetadataDataMember(init){Object.assign(this,init);}
return MetadataDataMember;}());exports.MetadataDataMember=MetadataDataMember;var MetadataAttribute=(function(){function MetadataAttribute(init){Object.assign(this,init);}
return MetadataAttribute;}());exports.MetadataAttribute=MetadataAttribute;var MetadataPropertyType=(function(){function MetadataPropertyType(init){Object.assign(this,init);}
return MetadataPropertyType;}());exports.MetadataPropertyType=MetadataPropertyType;var MetadataType=(function(){function MetadataType(init){Object.assign(this,init);}
return MetadataType;}());exports.MetadataType=MetadataType;var MetadataRoute=(function(){function MetadataRoute(init){Object.assign(this,init);}
return MetadataRoute;}());exports.MetadataRoute=MetadataRoute;var MetadataOperationType=(function(){function MetadataOperationType(init){Object.assign(this,init);}
return MetadataOperationType;}());exports.MetadataOperationType=MetadataOperationType;var MetadataTypes=(function(){function MetadataTypes(init){Object.assign(this,init);}
return MetadataTypes;}());exports.MetadataTypes=MetadataTypes;var AppMetadata=(function(){function AppMetadata(init){Object.assign(this,init);}
return AppMetadata;}());exports.AppMetadata=AppMetadata;var QueryBase=(function(){function QueryBase(init){Object.assign(this,init);}
return QueryBase;}());exports.QueryBase=QueryBase;var QueryDb=(function(_super){__extends(QueryDb,_super);function QueryDb(init){var _this=_super.call(this,init)||this;Object.assign(_this,init);return _this;}
return QueryDb;}(QueryBase));exports.QueryDb=QueryDb;var CrudEvent=(function(){function CrudEvent(init){Object.assign(this,init);}
return CrudEvent;}());exports.CrudEvent=CrudEvent;var ValidateRule=(function(){function ValidateRule(init){Object.assign(this,init);}
return ValidateRule;}());exports.ValidateRule=ValidateRule;var ValidationRule=(function(_super){__extends(ValidationRule,_super);function ValidationRule(init){var _this=_super.call(this,init)||this;Object.assign(_this,init);return _this;}
return ValidationRule;}(ValidateRule));exports.ValidationRule=ValidationRule;var Condition=(function(){function Condition(init){Object.assign(this,init);}
return Condition;}());exports.Condition=Condition;var GetSitesResponse=(function(){function GetSitesResponse(init){Object.assign(this,init);}
return GetSitesResponse;}());exports.GetSitesResponse=GetSitesResponse;var AuthenticateResponse=(function(){function AuthenticateResponse(init){Object.assign(this,init);}
return AuthenticateResponse;}());exports.AuthenticateResponse=AuthenticateResponse;var GetAppMetadataResponse=(function(){function GetAppMetadataResponse(init){Object.assign(this,init);}
return GetAppMetadataResponse;}());exports.GetAppMetadataResponse=GetAppMetadataResponse;var ModifyConnectionResponse=(function(){function ModifyConnectionResponse(init){Object.assign(this,init);}
return ModifyConnectionResponse;}());exports.ModifyConnectionResponse=ModifyConnectionResponse;var QueryResponse=(function(){function QueryResponse(init){Object.assign(this,init);}
return QueryResponse;}());exports.QueryResponse=QueryResponse;var GetValidationRulesResponse=(function(){function GetValidationRulesResponse(init){Object.assign(this,init);}
return GetValidationRulesResponse;}());exports.GetValidationRulesResponse=GetValidationRulesResponse;var AssignRolesResponse=(function(){function AssignRolesResponse(init){Object.assign(this,init);}
return AssignRolesResponse;}());exports.AssignRolesResponse=AssignRolesResponse;var UnAssignRolesResponse=(function(){function UnAssignRolesResponse(init){Object.assign(this,init);}
return UnAssignRolesResponse;}());exports.UnAssignRolesResponse=UnAssignRolesResponse;var RegisterResponse=(function(){function RegisterResponse(init){Object.assign(this,init);}
return RegisterResponse;}());exports.RegisterResponse=RegisterResponse;var GetSites=(function(){function GetSites(init){Object.assign(this,init);}
GetSites.prototype.createResponse=function(){return new GetSitesResponse();};GetSites.prototype.getTypeName=function(){return'GetSites';};return GetSites;}());exports.GetSites=GetSites;var SiteAuthenticate=(function(){function SiteAuthenticate(init){Object.assign(this,init);}
SiteAuthenticate.prototype.createResponse=function(){return new AuthenticateResponse();};SiteAuthenticate.prototype.getTypeName=function(){return'SiteAuthenticate';};return SiteAuthenticate;}());exports.SiteAuthenticate=SiteAuthenticate;var GetAppMetadata=(function(){function GetAppMetadata(init){Object.assign(this,init);}
GetAppMetadata.prototype.createResponse=function(){return new GetAppMetadataResponse();};GetAppMetadata.prototype.getTypeName=function(){return'GetAppMetadata';};return GetAppMetadata;}());exports.GetAppMetadata=GetAppMetadata;var SiteInvoke=(function(){function SiteInvoke(init){Object.assign(this,init);}
SiteInvoke.prototype.createResponse=function(){return'';};SiteInvoke.prototype.getTypeName=function(){return'SiteInvoke';};return SiteInvoke;}());exports.SiteInvoke=SiteInvoke;var SiteProxy=(function(){function SiteProxy(init){Object.assign(this,init);}
SiteProxy.prototype.createResponse=function(){return new Uint8Array(0);};SiteProxy.prototype.getTypeName=function(){return'SiteProxy';};return SiteProxy;}());exports.SiteProxy=SiteProxy;var ModifyConnection=(function(){function ModifyConnection(init){Object.assign(this,init);}
ModifyConnection.prototype.createResponse=function(){return new ModifyConnectionResponse();};ModifyConnection.prototype.getTypeName=function(){return'ModifyConnection';};return ModifyConnection;}());exports.ModifyConnection=ModifyConnection;var GetSiteAppPrefs=(function(){function GetSiteAppPrefs(init){Object.assign(this,init);}
GetSiteAppPrefs.prototype.createResponse=function(){return new AppPrefs();};GetSiteAppPrefs.prototype.getTypeName=function(){return'GetSiteAppPrefs';};return GetSiteAppPrefs;}());exports.GetSiteAppPrefs=GetSiteAppPrefs;var SaveSiteAppPrefs=(function(){function SaveSiteAppPrefs(init){Object.assign(this,init);}
SaveSiteAppPrefs.prototype.createResponse=function(){};SaveSiteAppPrefs.prototype.getTypeName=function(){return'SaveSiteAppPrefs';};return SaveSiteAppPrefs;}());exports.SaveSiteAppPrefs=SaveSiteAppPrefs;var GetCrudEvents=(function(_super){__extends(GetCrudEvents,_super);function GetCrudEvents(init){var _this=_super.call(this,init)||this;Object.assign(_this,init);return _this;}
GetCrudEvents.prototype.createResponse=function(){return new QueryResponse();};GetCrudEvents.prototype.getTypeName=function(){return'GetCrudEvents';};return GetCrudEvents;}(QueryDb));exports.GetCrudEvents=GetCrudEvents;var GetValidationRules=(function(){function GetValidationRules(init){Object.assign(this,init);}
GetValidationRules.prototype.createResponse=function(){return new GetValidationRulesResponse();};GetValidationRules.prototype.getTypeName=function(){return'GetValidationRules';};return GetValidationRules;}());exports.GetValidationRules=GetValidationRules;var ModifyValidationRules=(function(){function ModifyValidationRules(init){Object.assign(this,init);}
ModifyValidationRules.prototype.createResponse=function(){};ModifyValidationRules.prototype.getTypeName=function(){return'ModifyValidationRules';};return ModifyValidationRules;}());exports.ModifyValidationRules=ModifyValidationRules;var Authenticate=(function(){function Authenticate(init){Object.assign(this,init);}
Authenticate.prototype.createResponse=function(){return new AuthenticateResponse();};Authenticate.prototype.getTypeName=function(){return'Authenticate';};return Authenticate;}());exports.Authenticate=Authenticate;var AssignRoles=(function(){function AssignRoles(init){Object.assign(this,init);}
AssignRoles.prototype.createResponse=function(){return new AssignRolesResponse();};AssignRoles.prototype.getTypeName=function(){return'AssignRoles';};return AssignRoles;}());exports.AssignRoles=AssignRoles;var UnAssignRoles=(function(){function UnAssignRoles(init){Object.assign(this,init);}
UnAssignRoles.prototype.createResponse=function(){return new UnAssignRolesResponse();};UnAssignRoles.prototype.getTypeName=function(){return'UnAssignRoles';};return UnAssignRoles;}());exports.UnAssignRoles=UnAssignRoles;var Register=(function(){function Register(init){Object.assign(this,init);}
Register.prototype.createResponse=function(){return new RegisterResponse();};Register.prototype.getTypeName=function(){return'Register';};return Register;}());exports.Register=Register;;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};var __spreadArrays=(this&&this.__spreadArrays)||function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)
for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)
r[k]=a[j];return r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_1=require("vue");var client_1=require("@servicestack/client");exports.client=new client_1.JsonServiceClient('/');exports.debug=global.DEBUG;var client_2=require("@servicestack/client");exports.errorResponse=client_2.errorResponse;exports.errorResponseExcept=client_2.errorResponseExcept;exports.splitOnFirst=client_2.splitOnFirst;exports.toPascalCase=client_2.toPascalCase;exports.queryString=client_2.queryString;var dtos_1=require("./dtos");exports.ResponseStatus=dtos_1.ResponseStatus;exports.ResponseError=dtos_1.ResponseError;exports.Authenticate=dtos_1.Authenticate;exports.AuthenticateResponse=dtos_1.AuthenticateResponse;exports.Register=dtos_1.Register;exports.AppPrefs=dtos_1.AppPrefs;exports.Condition=dtos_1.Condition;var dtos_2=require("./dtos");var Roles;(function(Roles){Roles["Admin"]="Admin";})(Roles=exports.Roles||(exports.Roles={}));var logId=0;exports.store={nav:global.NAV_ITEMS,userSession:global.AUTH,userAttributes:client_1.UserAttributes.fromSession(global.AUTH),sites:[],apps:{},appTypes:{},appSessions:{},appLoading:{},appErrors:{},appDirty:{},appLogEntries:{},getSite:function(slug){return this.sites.filter(function(x){return x.slug==slug;})[0];},getApp:function(slug){return exports.store.apps[slug];},getSession:function(slug){return exports.store.appSessions[slug];},hasRole:function(slug,role){if(role=='AllowAnon')
return true;var session=this.getSession(slug);if(role=='AllowAnyUser'&&session)
return true;return role&&session&&session.roles&&session.roles.indexOf(role)>=0||false;},getAppPrefs:function(slug){var _a;return(_a=exports.store.getSite(slug))===null||_a===void 0?void 0:_a.prefs;},getType:function(slug,typeRef){if(!typeRef)
return null;var siteTypes=exports.store.appTypes[slug];var ret=siteTypes&&siteTypes[typeRef.namespace+'.'+typeRef.name]||siteTypes['.'+typeRef.name];if(!ret)
console.warn('Could not find type',typeRef.namespace,typeRef.name);return ret;},hasPlugin:function(slug,plugin){var _a,_b;return((_b=(_a=exports.store.getSite(slug))===null||_a===void 0?void 0:_a.plugins)===null||_b===void 0?void 0:_b.indexOf(plugin))>=0;},isDirty:function(slug){return exports.store.appDirty[slug];},logInvoke:function(method,invoke,response){var existingEntries=this.appLogEntries[invoke.slug]||[];var newEntries=__spreadArrays([{id:++logId,method:method,invoke:invoke,response:response}],existingEntries);vue_1.default.set(this.appLogEntries,invoke.slug,newEntries);return response;},logProxy:function(method,proxy,body,response){log('logProxy',method,proxy,body);var existingEntries=this.appLogEntries[proxy.slug]||[];var newEntries=__spreadArrays([{id:++logId,method:method,proxy:proxy,body:body,response:response}],existingEntries);vue_1.default.set(this.appLogEntries,proxy.slug,newEntries);return response;}};function log(){var o=[];for(var _i=0;_i<arguments.length;_i++){o[_i]=arguments[_i];}
if(exports.debug)
console.log.apply(console,arguments);return o;}
exports.log=log;exports.isQuery=function(op){var _a,_b;return(_b=(_a=op.request.inherits)===null||_a===void 0?void 0:_a.name)===null||_b===void 0?void 0:_b.startsWith('QueryDb`');};exports.crudInterfaces=['ICreateDb`1','IUpdateDb`1','IPatchDb`1','IDeleteDb`1'];exports.isCrud=function(op){var _a;return(_a=op.request.implements)===null||_a===void 0?void 0:_a.some(function(x){return exports.crudInterfaces.indexOf(x.name)>=0;});};exports.matchesType=function(x,y){return(x&&y)&&x.name==y.name&&((!x.namespace||!y.namespace)||x.namespace==y.namespace);};exports.collapsed=function(slug,view){var _a;return(((_a=exports.store.getAppPrefs(slug))===null||_a===void 0?void 0:_a.views)||[]).indexOf(view)==-1;};exports.toInvokeArgs=function(args){var to=[];if(!args)
return to;args.forEach(function(o){return Object.keys(o).forEach(function(k){to.push(k);to.push(o[k]);});});return to;};exports.argsAsKvps=function(args){var to=[];for(var i=0;i<args.length;i+=2){to.push({key:args[i],value:args[i+1]});}
return to;};exports.dtoAsArgs=function(dto){var to=[];for(var k in dto){var val=dto[k];if(typeof val=='function')
continue;to.push(k);to.push(""+dto[k]);}
return to;};exports.getSiteInvoke=function(invoke){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:_b=(_a=exports.store).logInvoke;_c=['GET',invoke];return[4,exports.client.get(invoke)];case 1:return[2,_b.apply(_a,_c.concat([_d.sent()]))];}});});};exports.postSiteInvoke=function(invoke){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:_b=(_a=exports.store).logInvoke;_c=['POST',invoke];return[4,exports.client.post(invoke)];case 1:return[2,_b.apply(_a,_c.concat([_d.sent()]))];}});});};exports.putSiteInvoke=function(invoke){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:_b=(_a=exports.store).logInvoke;_c=['PUT',invoke];return[4,exports.client.put(invoke)];case 1:return[2,_b.apply(_a,_c.concat([_d.sent()]))];}});});};exports.patchSiteInvoke=function(invoke){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:_b=(_a=exports.store).logInvoke;_c=['PATCH',invoke];return[4,exports.client.patch(invoke)];case 1:return[2,_b.apply(_a,_c.concat([_d.sent()]))];}});});};exports.deleteSiteInvoke=function(invoke){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:_b=(_a=exports.store).logInvoke;_c=['DELETE',invoke];return[4,exports.client.delete(invoke)];case 1:return[2,_b.apply(_a,_c.concat([_d.sent()]))];}});});};exports.postSiteProxy=function(proxy,body){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c,_d,_e;return __generator(this,function(_f){switch(_f.label){case 0:_b=(_a=exports.store).logProxy;_c=['POST',proxy,body];_e=(_d=new TextDecoder("utf-8")).decode;return[4,exports.client.postBody(proxy,body)];case 1:return[2,_b.apply(_a,_c.concat([_e.apply(_d,[_f.sent()])]))];}});});};var zero=function(){return 0;},doubleZero=function(){return 0.0;};var types={Byte:zero,Int16:zero,Int32:zero,Int64:zero,SByte:zero,UInt16:zero,UInt32:zero,UInt64:zero,Double:doubleZero,Single:doubleZero,DateTime:function(){return new Date().toISOString();},DateTimeOffset:function(){return new Date().toISOString();},TimeSpan:function(){return'00:00:00';},};exports.defaultValue=function(prop){var f=types[prop.type];return f?f():'';};exports.editValue=function(prop,value){if(typeof value=='string'){if(value.startsWith('/Date(')){return client_1.toDate(value).toISOString();}}
return value;};exports.getId=function(type,row){var pk=type.properties.find(function(x){return x.isPrimaryKey;});return pk&&client_1.getField(row,pk.name);};function exec(c,fn){return __awaiter(this,void 0,void 0,function(){var e_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,3,4]);c.loading=true;c.responseStatus=null;return[4,fn()];case 1:return[2,_a.sent()];case 2:e_1=_a.sent();c.responseStatus=e_1.responseStatus||e_1;c.$emit('error',c.responseStatus);return[3,4];case 3:c.loading=false;return[7];case 4:return[2];}});});}
exports.exec=exec;var EventBus=(function(_super){__extends(EventBus,_super);function EventBus(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.store=exports.store;return _this;}
return EventBus;}(vue_1.default));exports.bus=new EventBus({data:exports.store});exports.canAccess=function(slug,op){var _a,_b,_c,_d;if(!op.requiresAuth)
return true;var session=exports.store.appSessions[slug];if(!session)
return false;var userRoles=session.roles||[];if(((_a=op.requiredRoles)===null||_a===void 0?void 0:_a.length)>0&&!op.requiredRoles.every(function(role){return userRoles.indexOf(role)>=0;}))
return false;if(((_b=op.requiresAnyRole)===null||_b===void 0?void 0:_b.length)>0&&!op.requiresAnyRole.some(function(role){return userRoles.indexOf(role)>=0;}))
return false;var userPermissions=session.permissions||[];if(((_c=op.requiredPermissions)===null||_c===void 0?void 0:_c.length)>0&&!op.requiredRoles.every(function(perm){return userPermissions.indexOf(perm)>=0;}))
return false;if(((_d=op.requiresAnyPermission)===null||_d===void 0?void 0:_d.length)>0&&!op.requiresAnyPermission.every(function(perm){return userPermissions.indexOf(perm)>=0;}))
return false;return true;};exports.loadSite=function(slug,force){return __awaiter(void 0,void 0,void 0,function(){var site,response,metadata,response,e_2;return __generator(this,function(_a){switch(_a.label){case 0:if(exports.store.appErrors[slug]&&!force)
return[2];log("loading site: "+slug+"...");site=exports.store.getSite(slug);_a.label=1;case 1:_a.trys.push([1,6,7,8]);exports.bus.$emit('appLoading',{slug:slug,result:true});if(!!site)return[3,3];return[4,exports.client.get(new dtos_2.GetSites())];case 2:response=_a.sent();exports.bus.$emit('sites',response.sites);if(!response){exports.bus.$emit('appError',{slug:slug,result:new dtos_2.ResponseStatus({errorCode:'NotFound',message:"Site does not exist '"+slug+"'"})});return[2];}
_a.label=3;case 3:metadata=exports.store.getApp(slug);if(!!metadata)return[3,5];return[4,exports.client.get(new dtos_2.GetAppMetadata({slug:slug}))];case 4:response=_a.sent();exports.bus.$emit('app',response);_a.label=5;case 5:return[3,8];case 6:e_2=_a.sent();exports.bus.$emit('appError',{slug:slug,result:e_2.responseStatus||e_2});return[3,8];case 7:exports.bus.$emit('appLoading',{slug:slug,result:false});return[7];case 8:return[2];}});});};vue_1.default.filter('upper',function(value){var _a;return(_a=value)===null||_a===void 0?void 0:_a.toUpperCase();});exports.bus.$on('sites',function(sites){exports.bus.$set(exports.store,'sites',sites);});exports.bus.$on('removeSite',function(slug){exports.bus.$set(exports.store,'sites',exports.store.sites.filter(function(x){return x.slug!=slug;}));exports.bus.$delete(exports.store.apps,slug);exports.bus.$delete(exports.store.appTypes,slug);exports.bus.$delete(exports.store.appSessions,slug);exports.bus.$delete(exports.store.appLoading,slug);exports.bus.$delete(exports.store.appErrors,slug);});exports.bus.$on('app',function(app){log('on$app',app.slug,app.result);var newApps=Object.assign({},exports.store.apps);newApps[app.slug]=app.result;exports.bus.$set(exports.store,'apps',newApps);var typesMap={};var api=app.result.api;var allTypes=__spreadArrays(api.types,api.operations.map(function(op){return op.request;}),api.operations.filter(function(op){return op.response;}).map(function(op){return op.response;}));allTypes.forEach(function(x){if(x.namespace)
typesMap[x.namespace+'.'+x.name]=x;typesMap['.'+x.name]=x;});var newAppTypes=Object.assign({},exports.store.appTypes);newAppTypes[app.slug]=typesMap;exports.bus.$set(exports.store,'appTypes',newAppTypes);});exports.bus.$on('savePrefs',function(siteResult){return __awaiter(void 0,void 0,void 0,function(){var slug,callback;return __generator(this,function(_a){switch(_a.label){case 0:slug=siteResult.slug,callback=siteResult.callback;log('savePrefs',slug);return[4,exports.client.post(new dtos_2.SaveSiteAppPrefs({slug:slug,appPrefs:exports.store.getAppPrefs(slug)}))];case 1:_a.sent();vue_1.default.delete(exports.store.appDirty,slug);if(callback)
callback();return[2];}});});});exports.bus.$on('signout',function(siteResult){var slug=siteResult.slug;exports.bus.$emit('appSession',{slug:slug,result:null});exports.bus.$emit('signedout');});exports.bus.$on('appSession',function(siteResult){var newSessions=Object.assign({},exports.store.appSessions);newSessions[siteResult.slug]=siteResult.result;exports.bus.$set(exports.store,'appSessions',newSessions);exports.bus.$emit('signedin');});exports.bus.$on('appLoading',function(siteResult){var newLoading=Object.assign({},exports.store.appLoading);newLoading[siteResult.slug]=siteResult.result;exports.bus.$set(exports.store,'appLoading',newLoading);});exports.bus.$on('appError',function(siteResult){log('appError',siteResult.slug,siteResult.result);var newErrors=Object.assign({},exports.store.appErrors);newErrors[siteResult.slug]=siteResult.result;exports.bus.$set(exports.store,'appErrors',newErrors);});exports.bus.$on('appPrefs',function(siteResult){var slug=siteResult.slug,request=siteResult.request,queryConditions=siteResult.queryConditions;log('appPrefs',slug,request,queryConditions);var siteIndex=exports.store.sites.findIndex(function(x){return x.slug==slug;});var site=exports.store.sites[siteIndex];if(!site)
return;if(queryConditions){var appPrefs=site.prefs||new dtos_2.AppPrefs({queryConditions:{}});vue_1.default.set(appPrefs.queryConditions,request,queryConditions);vue_1.default.set(site,'prefs',appPrefs);vue_1.default.set(exports.store.sites,siteIndex,site);}
vue_1.default.set(exports.store.appDirty,slug,true);log('isDirty',exports.store.isDirty(slug));});exports.checkAuth=function(){return __awaiter(void 0,void 0,void 0,function(){var _a,_b,_c,e_3;return __generator(this,function(_d){switch(_d.label){case 0:_d.trys.push([0,2,,3]);_b=(_a=exports.bus).$emit;_c=['signin'];return[4,exports.client.post(new dtos_2.Authenticate())];case 1:_b.apply(_a,_c.concat([_d.sent()]));return[3,3];case 2:e_3=_d.sent();exports.bus.$emit('signout');return[3,3];case 3:return[2];}});});};;
})();
(function(){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var vue_1=require("vue");var vue_router_1=require("vue-router");var index_1=require("./index");var vue_2=require("@servicestack/vue");var Home_1=require("../components/Home");var AutoQuery_1=require("../components/AutoQuery");var Validation_1=require("../components/Validation");var About_1=require("../components/About");var client_1=require("@servicestack/client");var Routes;(function(Routes){Routes["Home"]="/";Routes["AutoQuery"]="/:slug/autoquery";Routes["Validation"]="/:slug/validation";Routes["About"]="/about";Routes["Forbidden"]="/forbidden";})(Routes=exports.Routes||(exports.Routes={}));vue_1.default.use(vue_router_1.default);function requiresAuth(to,from,next){if(!index_1.store.userSession){return;}
next();}
function requiresRole(role){return function(to,from,next){if(!index_1.store.userSession){}
else if(!index_1.store.userSession.roles||index_1.store.userSession.roles.indexOf(role)<0){next(Routes.Forbidden+"?role="+encodeURIComponent(role));}
else{next();}};}
var routes=[{path:Routes.Home,component:Home_1.Home,props:{name:''}},{path:Routes.AutoQuery,component:AutoQuery_1.AutoQuery},{path:Routes.Validation,component:Validation_1.Validation},{path:Routes.About,component:About_1.About,props:{message:'About page'}},{path:Routes.Forbidden,component:vue_2.Forbidden},{path:'*',redirect:'/'},];exports.autoQueryRoute=function(slug,args){return client_1.appendQueryString(Routes.AutoQuery.replace(':slug',slug),args);};exports.validationRoute=function(slug,args){return client_1.appendQueryString(Routes.Validation.replace(':slug',slug),args);};exports.router=new vue_router_1.default({mode:'history',linkActiveClass:'active',routes:routes,});exports.default=exports.router;exports.redirect=function(path){index_1.log('redirect',path);var externalUrl=path.indexOf('://')>=0;if(!externalUrl){exports.router.push({path:path});}
else{location.href=path;}};;
})();
(function(){
"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();var __decorate=(this&&this.__decorate)||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};Object.defineProperty(exports,"__esModule",{value:true});var vue_1=require("vue");var vue_property_decorator_1=require("vue-property-decorator");var shared_1=require("./shared");var App=(function(_super){__extends(App,_super);function App(){return _super!==null&&_super.apply(this,arguments)||this;}
Object.defineProperty(App.prototype,"store",{get:function(){return shared_1.store;},enumerable:true,configurable:true});App=__decorate([vue_property_decorator_1.Component({template:"<div class=\"has-auth2\">\n        <router-view></router-view>\n    </div>"})],App);return App;}(vue_1.default));exports.App=App;exports.default=App;;
})();
(function(){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("./app.scss");require("es6-shim");var vue_1=require("vue");var vue_2=require("@servicestack/vue");vue_1.default.use(vue_2.default);var App_1=require("./App");var router_1=require("./shared/router");var app=new vue_1.default({el:'#app',render:function(h){return h(App_1.App);},router:router_1.router});;
})();
